(function($,w,r,e)
{if(typeof(e.EntityNotFound)!=="undefined")
{return}
var _e=function()
{Error.apply(this,arguments)};_e.prototype=Object.create(Error.prototype);_e.prototype.constructor=_e;e.EntityNotFound=_e})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Exception=window.ReserviCloud.Exception||{});(function($,w,r)
{r.Core={unimplemented:function()
{this.error("Unimplemented method")},error:function(msg)
{throw new Error(msg)},log:function(msg)
{if(typeof(console.log)==="function")
{console.log(msg)}},warning:function(msg)
{var _m=(typeof(console.warn)==="function")?console.warn:this.log;_m(msg)}}})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{});(function($,w,r,s)
{if(typeof(s.Abstract)!=="undefined")
{return}
var abstract=function(rWidget,rId,data)
{if(!rWidget)
{r.Core.error("There is no widget object")}
if(!rId)
{r.Core.error("There is no step id")}
this.widget=rWidget;this.id=rId;this.clearPos(0);if(!data)
{data={}}
this.template=(data.template)?data.template:this.onNullTemplate();this.info=data.data||{};this.setParams({});this.buildStep()};abstract.prototype.getWidget=function()
{return this.widget};abstract.prototype.isCurrent=function()
{return this.getWidget().getCurrentStep()===this};abstract.prototype.selectStep=function()
{this.getWidget().selectStep(this)};abstract.prototype.getStepId=function()
{return this.id};abstract.prototype.getTemplate=function(f)
{var res=this.template||{};return((f)?res[f]:res)||""};abstract.prototype.getData=function(key)
{return(key)?this.info[key]:this.info};abstract.prototype.getParams=function(param)
{return(param)?this.params[param]:this.params};abstract.prototype.setParams=function(params)
{this.params=params||{}};abstract.prototype.setData=function(key,data)
{this.info[key]=data};abstract.prototype.buildStep=function()
{this.getWidget().getStepsHeadersElement().append('<div class="reservi_widget_step_header" style="display: none;"'+' data-step="'+this.getStepId()+'">'+this.proccessHeadTemplate(this.getTemplate()["head"]||"",this.getData(),this.getTemplate())+'</div>');this.getWidget().getStepsElement().append('<div class="reservi_widget_step" style="display: none;"'+' id="'+this.getStepId()+'">'+this.proccessBodyTemplate(this.getTemplate()["body"]||"",this.getData(),this.getTemplate())+'</div>');this.onStart()};abstract.prototype.onNullTemplate=function()
{r.Core.unimplemented()};abstract.prototype.proccessXTemplate=function(template,data)
{return r.Templates.Processor.process(template,data||{})};abstract.prototype.getBodyData=function(data,td)
{r.Core.unimplemented()};abstract.prototype.proccessBodyTemplate=function(template,data,td)
{return this.proccessXTemplate(template,this.getBodyData(data,td))};abstract.prototype.getHeadData=function(data,td)
{r.Core.unimplemented()};abstract.prototype.proccessHeadTemplate=function(template,data,td)
{return this.proccessXTemplate(template,this.getHeadData(data,td))};abstract.prototype.getBodyElement=function()
{if(!this.bodyElement)
{this.bodyElement=this.getWidget().getStepsElement().find("#"+this.getStepId())}
return this.bodyElement};abstract.prototype.getHeaderElement=function()
{if(!this.headerElement)
{this.headerElement=this.getWidget().getStepsHeadersElement().find(".reservi_widget_step_header[data-step='"+this.getStepId()+"']")}
return this.headerElement};abstract.prototype.getStepElements=function()
{if(!this.stepElements)
{this.stepElements=this.getHeaderElement().add(this.getBodyElement())}
return this.stepElements};abstract.prototype.getPostContentElement=function()
{return null};abstract.prototype.getStepChangeElements=function(state,step)
{var elements=this.getStepElements(),tisPostElement=this.getPostContentElement(),nextPostElement=(step)?this.getWidget().getStep(step).getPostContentElement():null;if(tisPostElement&&tisPostElement.length&&(!nextPostElement||nextPostElement.length<=0||!tisPostElement.is(nextPostElement)))
{elements=elements.add(tisPostElement)}
return elements};abstract.prototype.toggleStepFade=function(state,step,callback)
{var self=this,bHide=state===!1,elements=this.getStepChangeElements(state,step),last=elements.length-1,before=(bHide)?"onBeforeHide":"onBeforeShow",end=(bHide)?"onHide":"onShow",restore=(bHide)?"__restoreSavePos":"__restorePos",action=(bHide)?"fadeOut":"fadeIn";this[before](step);this[restore]();elements[action](this.getWidget().getFadeSpeed(),function()
{if(elements.index($(this))!==last)
{return}
if(typeof(callback)==="function")
{callback(step)}
self[end](step)})};abstract.prototype.__restoreSavePos=function()
{if(this.isRestorePos())
{this.__prevPos=this.getWidget().getScroll().getPos()}};abstract.prototype.__restorePos=function()
{if(this.__prevPos!==!1)
{var self=this,_w=this.getWidget(),t=(this.__prevPos>0)?this.__prevPos:0,scroll=_w.getScroll();_w.getTimeouter().add(function()
{scroll.update();scroll.scrollTo(t,0)},5);this.clearPos()}};abstract.prototype.clearPos=function(v)
{this.__prevPos=v!==undefined?v:!1};abstract.prototype.hide=function(next,callback)
{this.toggleStepFade(!1,next,callback)};abstract.prototype.show=function(prev,callback)
{this.toggleStepFade(!0,prev,callback)};abstract.prototype.onStart=function()
{};abstract.prototype.onBeforeShow=function(prev)
{};abstract.prototype.onShow=function(prev)
{};abstract.prototype.onBeforeHide=function(next)
{};abstract.prototype.onHide=function(next)
{};abstract.prototype.purge=function()
{this.onDestroy();this.getHeaderElement().remove();this.getBodyElement().remove()};abstract.prototype.onDestroy=function()
{};abstract.prototype.isRestorePos=function()
{return!0};abstract.prototype.getPrevStep=function()
{r.Core.unimplemented()};s.Abstract=abstract})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{});!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){e.fn.jScrollPaneReservi=function(t){function i(t,i){var o,n,s,r,a,l,c,p,d,u,f,h,j,g,v,m,b,w,y,k,C,T,B,D,x,H,P,S,A,W,Y,R,z,M,X=this,I=!0,F=!0,L=!1,q=!1,O=t.clone(!1,!1).empty(),E=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";function V(i){if(!(e("input:focus").length>0)){var k,I,F,L,q,O,ae,le,ce,pe,de,ue,fe,he,je=!1,ge=!1;if(o=i,void 0===n)q=t.scrollTop(),O=t.scrollLeft(),t.css({overflow:"hidden",padding:0}),s=t.innerWidth()+z,r=t.innerHeight(),t.width(s),n=e('<div class="jspPane" />').css("padding",R).append(t.children()),a=e('<div class="jspContainer" />').css({width:s+"px",height:r+"px"}).append(n).appendTo(t);else{if(t.css("width",""),je=o.stickToBottom&&(le=c-r)>20&&le-se()<10,ge=o.stickToRight&&(ae=l-s)>20&&ae-ne()<10,(L=t.innerWidth()+z!=s||t.outerHeight()!=r)&&(s=t.innerWidth()+z,r=t.innerHeight(),a.css({width:s+"px",height:r+"px"})),!L&&M==l&&n.outerHeight()==c)return void t.width(s);M=l,n.css("width",""),t.width(s),a.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}n.css("overflow","auto"),l=i.contentWidth?i.contentWidth:n[0].scrollWidth,c=n[0].scrollHeight,n.css("overflow",""),u=(d=c/r)>1,(f=(p=l/s)>1)||u?(t.addClass("jspScrollable"),(k=o.maintainPosition&&(g||b))&&(I=ne(),F=se()),u&&(a.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />'))),w=a.find(">.jspVerticalBar"),y=w.find(">.jspTrack"),h=y.find(">.jspDrag"),o.showArrows&&(B=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",Q(0,-1)).bind("click.jsp",re),D=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",Q(0,1)).bind("click.jsp",re),o.arrowScrollOnHover&&(B.bind("mouseover.jsp",Q(0,-1,B)),D.bind("mouseover.jsp",Q(0,1,D))),K(y,o.verticalArrowPositions,B,D)),C=r,a.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){C-=e(this).outerHeight()}),h.hover(function(){h.addClass("jspHover")},function(){h.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",re),h.addClass("jspActive");var i=t.pageY-h.position().top;return e("html").bind("mousemove.jsp",function(e){J(e.pageY-i,!1)}).bind("mouseup.jsp mouseleave.jsp",$),!1}),G()),f&&(a.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />'))),x=a.find(">.jspHorizontalBar"),H=x.find(">.jspTrack"),v=H.find(">.jspDrag"),o.showArrows&&(A=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",Q(-1,0)).bind("click.jsp",re),W=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",Q(1,0)).bind("click.jsp",re),o.arrowScrollOnHover&&(A.bind("mouseover.jsp",Q(-1,0,A)),W.bind("mouseover.jsp",Q(1,0,W))),K(H,o.horizontalArrowPositions,A,W)),v.hover(function(){v.addClass("jspHover")},function(){v.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",re),v.addClass("jspActive");var i=t.pageX-v.position().left;return e("html").bind("mousemove.jsp",function(e){_(e.pageX-i,!1)}).bind("mouseup.jsp mouseleave.jsp",$),!1}),P=a.innerWidth(),N()),function(){if(f&&u){var t=H.outerHeight(),i=y.outerWidth();C-=t,e(x).find(">.jspCap:visible,>.jspArrow").each(function(){P+=e(this).outerWidth()}),P-=i,r-=i,s-=t,H.parent().append(e('<div class="jspCorner" />').css("width",t+"px")),G(),N()}f&&n.width(a.outerWidth()-z+"px"),c=n.outerHeight(),d=c/r,f&&((S=Math.ceil(1/p*P))>o.horizontalDragMaxWidth?S=o.horizontalDragMaxWidth:S<o.horizontalDragMinWidth&&(S=o.horizontalDragMinWidth),v.width(S+"px"),m=P-S,ee(b)),u&&((T=Math.ceil(1/d*C))>o.verticalDragMaxHeight?T=o.verticalDragMaxHeight:T<o.verticalDragMinHeight&&(T=o.verticalDragMinHeight),h.height(T+"px"),j=C-T,Z(g))}(),k&&(ie(ge?l-s:I,!1),te(je?c-r:F,!1)),n.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){oe(e.target,!1)}),a.unbind(E).bind(E,function(e,t,i,n){b||(b=0),g||(g=0);var s=b,r=g,a=e.deltaFactor||o.mouseWheelSpeed;return X.scrollBy(i*a,-n*a,!1),s==b&&r==g}),he=!1,a.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(e){var t=e.originalEvent.touches[0];ce=ne(),pe=se(),de=t.pageX,ue=t.pageY,fe=!1,he=!0}).bind("touchmove.jsp",function(e){if(he){var t=e.originalEvent.touches[0],i=b,o=g;return X.scrollTo(ce+de-t.pageX,pe+ue-t.pageY),fe=fe||Math.abs(de-t.pageX)>5||Math.abs(ue-t.pageY)>5,i==b&&o==g}}).bind("touchend.jsp",function(e){he=!1}).bind("click.jsp-touchclick",function(e){if(fe)return fe=!1,!1}),o.enableKeyboardNavigation&&function(){var i,s,l=[];function p(){var e=b,t=g;switch(i){case 40:X.scrollByY(o.keyboardSpeed,!1);break;case 38:X.scrollByY(-o.keyboardSpeed,!1);break;case 34:case 32:X.scrollByY(r*o.scrollPagePercent,!1);break;case 33:X.scrollByY(-r*o.scrollPagePercent,!1);break;case 39:X.scrollByX(o.keyboardSpeed,!1);break;case 37:X.scrollByX(-o.keyboardSpeed,!1)}return s=e!=b||t!=g}f&&l.push(x[0]),u&&l.push(w[0]),n.bind("focus.jsp",function(){t.focus()}),t.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(t){if(t.target===this||l.length&&e(t.target).closest(l).length){var o=b,n=g;switch(t.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:i=t.keyCode,p();break;case 35:te(c-r),i=null;break;case 36:te(0),i=null}return!(s=t.keyCode==i&&o!=b||n!=g)}}).bind("keypress.jsp",function(t){if(t.keyCode==i&&p(),t.target===this||l.length&&e(t.target).closest(l).length)return!s}),o.hideFocus?(t.css("outline","none"),"hideFocus"in a[0]&&t.attr("hideFocus",!0)):(t.css("outline",""),"hideFocus"in a[0]&&t.attr("hideFocus",!1))}(),o.clickOnTrack&&(U(),u&&y.bind("mousedown.jsp",function(t){if(void 0===t.originalTarget||t.originalTarget==t.currentTarget){var i,n=e(this),s=n.offset(),a=t.pageY-s.top-g,l=!0,p=function(){var e=n.offset(),s=t.pageY-e.top-T/2,u=r*o.scrollPagePercent,f=j*u/(c-r);if(a<0)g-f>s?X.scrollByY(-u):J(s);else{if(!(a>0))return void d();g+f<s?X.scrollByY(u):J(s)}i=setTimeout(p,l?o.initialDelay:o.trackClickRepeatFreq),l=!1},d=function(){i&&clearTimeout(i),i=null,e(document).unbind("mouseup.jsp",d)};return p(),e(document).bind("mouseup.jsp",d),!1}}),f&&H.bind("mousedown.jsp",function(t){if(void 0===t.originalTarget||t.originalTarget==t.currentTarget){var i,n=e(this),r=n.offset(),a=t.pageX-r.left-b,c=!0,p=function(){var e=n.offset(),r=t.pageX-e.left-S/2,u=s*o.scrollPagePercent,f=m*u/(l-s);if(a<0)b-f>r?X.scrollByX(-u):_(r);else{if(!(a>0))return void d();b+f<r?X.scrollByX(u):_(r)}i=setTimeout(p,c?o.initialDelay:o.trackClickRepeatFreq),c=!1},d=function(){i&&clearTimeout(i),i=null,e(document).unbind("mouseup.jsp",d)};return p(),e(document).bind("mouseup.jsp",d),!1}})),function(){if(location.hash&&location.hash.length>1){var t,i,o=escape(location.hash.substr(1));try{t=e("#"+o+', a[name="'+o+'"]')}catch(e){return}t.length&&n.find(o)&&(0===a.scrollTop()?i=setInterval(function(){a.scrollTop()>0&&(oe(t,!0),e(document).scrollTop(a.position().top),clearInterval(i))},50):(oe(t,!0),e(document).scrollTop(a.position().top)))}}(),o.hijackInternalLinks&&(e(document.body).data("jspHijack")||(e(document.body).data("jspHijack",!0),e(document.body).delegate('a[href*="#"]',"click",function(t){var i,o,n,s,r,a=this.href.substr(0,this.href.indexOf("#")),l=location.href;if(-1!==location.href.indexOf("#")&&(l=location.href.substr(0,location.href.indexOf("#"))),a===l){i=escape(this.href.substr(this.href.indexOf("#")+1));try{o=e("#"+i+', a[name="'+i+'"]')}catch(e){return}o.length&&((n=o.closest(".jspScrollable")).data("jsp").scrollToElement(o,!0),n[0].scrollIntoView&&(s=e(window).scrollTop(),((r=o.offset().top)<s||r>s+e(window).height())&&n[0].scrollIntoView()),t.preventDefault())}})))):(t.removeClass("jspScrollable"),n.css({top:0,left:0,width:a.width()-z}),a.unbind(E),n.find(":input,a").unbind("focus.jsp"),t.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp"),n.unbind(".jsp"),U()),o.autoReinitialise&&!Y?Y=setInterval(function(){V(o)},o.autoReinitialiseDelay):!o.autoReinitialise&&Y&&clearInterval(Y),q&&t.scrollTop(0)&&te(q,!1),O&&t.scrollLeft(0)&&ie(O,!1),t.trigger("jsp-initialised",[f||u])}}function G(){y.height(C+"px"),g=0,k=o.verticalGutter+y.outerWidth(),n.width(s-k-z);try{0===w.position().left&&n.css("margin-left",k+"px")}catch(e){}}function N(){a.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){P-=e(this).outerWidth()}),H.width(P+"px"),b=0}function K(e,t,i,o){var n,s="before",r="after";"os"==t&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==s?r=t:t==r&&(s=t,n=i,i=o,o=n),e[s](i)[r](o)}function Q(t,i,n){return function(){return function(t,i,n,s){n=e(n).addClass("jspActive");var r,a,l=!0,c=function(){0!==t&&X.scrollByX(t*o.arrowButtonSpeed),0!==i&&X.scrollByY(i*o.arrowButtonSpeed),a=setTimeout(c,l?o.initialDelay:o.arrowRepeatFreq),l=!1};c(),r=s?"mouseout.jsp":"mouseup.jsp",(s=s||e("html")).bind(r,function(){n.removeClass("jspActive"),a&&clearTimeout(a),a=null,s.unbind(r)})}(t,i,this,n),this.blur(),!1}}function U(){H&&H.unbind("mousedown.jsp"),y&&y.unbind("mousedown.jsp")}function $(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),h&&h.removeClass("jspActive"),v&&v.removeClass("jspActive")}function J(i,n){if(u){i<0?i=0:i>j&&(i=j);var s=new e.Event("jsp-will-scroll-y");if(t.trigger(s,[i]),!s.isDefaultPrevented()){var a=i||0,l=0===a,p=a==j,d=-i/j*(c-r);void 0===n&&(n=o.animateScroll),n?X.animate(h,"top",i,Z,function(){t.trigger("jsp-user-scroll-y",[-d,l,p])}):(h.css("top",i),Z(i),t.trigger("jsp-user-scroll-y",[-d,l,p]))}}}function Z(e){void 0===e&&(e=h.position().top),a.scrollTop(0);var i=0===(g=e||0),s=g==j,l=-e/j*(c-r);I==i&&L==s||(I=i,L=s,t.trigger("jsp-arrow-change",[I,L,F,q])),function(e,t){o.showArrows&&(B[e?"addClass":"removeClass"]("jspDisabled"),D[t?"addClass":"removeClass"]("jspDisabled"))}(i,s),n.css("top",l),t.trigger("jsp-scroll-y",[-l,i,s]).trigger("scroll")}function _(i,n){if(f){i<0?i=0:i>m&&(i=m);var r=new e.Event("jsp-will-scroll-x");if(t.trigger(r,[i]),!r.isDefaultPrevented()){var a=i||0,c=0===a,p=a==m,d=-i/m*(l-s);void 0===n&&(n=o.animateScroll),n?X.animate(v,"left",i,ee,function(){t.trigger("jsp-user-scroll-x",[-d,c,p])}):(v.css("left",i),ee(i),t.trigger("jsp-user-scroll-x",[-d,c,p]))}}}function ee(e){void 0===e&&(e=v.position().left),a.scrollTop(0);var i=0===(b=e||0),r=b==m,c=-e/m*(l-s);F==i&&q==r||(F=i,q=r,t.trigger("jsp-arrow-change",[I,L,F,q])),function(e,t){o.showArrows&&(A[e?"addClass":"removeClass"]("jspDisabled"),W[t?"addClass":"removeClass"]("jspDisabled"))}(i,r),n.css("left",c),t.trigger("jsp-scroll-x",[-c,i,r]).trigger("scroll")}function te(e,t){J(e/(c-r)*j,t)}function ie(e,t){_(e/(l-s)*m,t)}function oe(t,i,n){var l,c,p,d,u,f,h,j,g,v=0,m=0;try{l=e(t)}catch(e){return}for(c=l.outerHeight(),p=l.outerWidth(),a.scrollTop(0),a.scrollLeft(0);!l.is(".jspPane");)if(v+=l.position().top,m+=l.position().left,l=l.offsetParent(),/^body|html$/i.test(l[0].nodeName))return;f=(d=se())+r,v<d||i?j=v-o.horizontalGutter:v+c>f&&(j=v-r+c+o.horizontalGutter),isNaN(j)||te(j,n),h=(u=ne())+s,m<u||i?g=m-o.horizontalGutter:m+p>h&&(g=m-s+p+o.horizontalGutter),isNaN(g)||ie(g,n)}function ne(){return-n.position().left}function se(){return-n.position().top}function re(){return!1}"border-box"===t.css("box-sizing")?(R=0,z=0):(R=t.css("paddingTop")+" "+t.css("paddingRight")+" "+t.css("paddingBottom")+" "+t.css("paddingLeft"),z=(parseInt(t.css("paddingLeft"),10)||0)+(parseInt(t.css("paddingRight"),10)||0)),e.extend(X,{reinitialise:function(t){V(t=e.extend({},o,t))},scrollToElement:function(e,t,i){oe(e,t,i)},scrollTo:function(e,t,i){ie(e,i),te(t,i)},scrollToX:function(e,t){ie(e,t)},scrollToY:function(e,t){te(e,t)},scrollToPercentX:function(e,t){ie(e*(l-s),t)},scrollToPercentY:function(e,t){te(e*(c-r),t)},scrollBy:function(e,t,i){X.scrollByX(e,i),X.scrollByY(t,i)},scrollByX:function(e,t){_((ne()+Math[e<0?"floor":"ceil"](e))/(l-s)*m,t)},scrollByY:function(e,t){J((se()+Math[e<0?"floor":"ceil"](e))/(c-r)*j,t)},positionDragX:function(e,t){_(e,t)},positionDragY:function(e,t){J(e,t)},animate:function(e,t,i,n,s){var r={};r[t]=i,e.animate(r,{duration:o.animateDuration,easing:o.animateEase,queue:!1,step:n,complete:s})},getContentPositionX:function(){return ne()},getContentPositionY:function(){return se()},getContentWidth:function(){return l},getContentHeight:function(){return c},getPercentScrolledX:function(){return ne()/(l-s)},getPercentScrolledY:function(){return se()/(c-r)},getIsScrollableH:function(){return f},getIsScrollableV:function(){return u},getContentPane:function(){return n},scrollToBottom:function(e){J(j,e)},hijackInternalLinks:e.noop,destroy:function(){var e,i;e=se(),i=ne(),t.removeClass("jspScrollable").unbind(".jsp"),n.unbind(".jsp"),t.replaceWith(O.append(n.children())),O.scrollTop(e),O.scrollLeft(i),Y&&clearInterval(Y)}}),V(i)}return t=e.extend({},e.fn.jScrollPaneReservi.defaults,t),e.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){t[this]=t[this]||t.speed}),this.each(function(){var o=e(this),n=o.data("jsp");n?n.reinitialise(t):(e("script",o).filter('[type="text/javascript"],:not([type])').remove(),n=new i(o,t),o.data("jsp",n))})},e.fn.jScrollPaneReservi.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:void 0,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}});(function(w)
{if(typeof w.CustomEvent==="function"){return!1}
function CustomEvent(event,params)
{params=params||{bubbles:!1,cancelable:!1,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}
CustomEvent.prototype=w.Event.prototype;w.CustomEvent=CustomEvent})(window);if(!Object.keys){Object.keys=(function(){'use strict';var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=='function'&&(typeof obj!=='object'||obj===null)){throw new TypeError('Object.keys called on non-object')}
var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop)}}
if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i])}}}
return result}}())};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){var t,i,n=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var s=n.length;s;)e.event.fixHooks[n[--s]]=e.event.mouseHooks;var a=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=o.length;t;)this.addEventListener(o[--t],h,!1);else this.onmousewheel=h;e.data(this,"mousewheel-line-height",a.getLineHeight(this)),e.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=o.length;t;)this.removeEventListener(o[--t],h,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),n=i["offsetParent"in e.fn?"offsetParent":"parent"]();return n.length||(n=e("body")),parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function h(n){var o,s=n||window.event,h=l.call(arguments,1),f=0,d=0,c=0,m=0,g=0;if((n=e.event.fix(s)).type="mousewheel","detail"in s&&(c=-1*s.detail),"wheelDelta"in s&&(c=s.wheelDelta),"wheelDeltaY"in s&&(c=s.wheelDeltaY),"wheelDeltaX"in s&&(d=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(d=-1*c,c=0),f=0===c?d:c,"deltaY"in s&&(f=c=-1*s.deltaY),"deltaX"in s&&(d=s.deltaX,0===c&&(f=-1*d)),0!==c||0!==d){if(1===s.deltaMode){var w=e.data(this,"mousewheel-line-height");f*=w,c*=w,d*=w}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");f*=v,c*=v,d*=v}if(o=Math.max(Math.abs(c),Math.abs(d)),(!i||o<i)&&(i=o,u(s,o)&&(i/=40)),u(s,o)&&(f/=40,d/=40,c/=40),f=Math[f>=1?"floor":"ceil"](f/i),d=Math[d>=1?"floor":"ceil"](d/i),c=Math[c>=1?"floor":"ceil"](c/i),a.settings.normalizeOffset&&this.getBoundingClientRect){var p=this.getBoundingClientRect();m=n.clientX-p.left,g=n.clientY-p.top}return n.deltaX=d,n.deltaY=c,n.deltaFactor=i,n.offsetX=m,n.offsetY=g,n.deltaMode=0,h.unshift(n,f,d,c),t&&clearTimeout(t),t=setTimeout(r,200),(e.event.dispatch||e.event.handle).apply(this,h)}}function r(){i=null}function u(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}e.fn.extend({mousewheelReservi:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheelReservi:function(e){return this.unbind("mousewheel",e)}})});(function($,w,r,s)
{if(typeof(s.LoadableStep)!=="undefined")
{return}
var loadable=function(widget,id,data)
{s.Abstract.apply(this,arguments);this.__update=!0;this.loadableData=!1};loadable.prototype=Object.create(s.Abstract.prototype);loadable.prototype.super_proccessBodyTemplate=loadable.prototype.proccessBodyTemplate;loadable.prototype.constructor=loadable;loadable.prototype.updateContent=function(data,content)
{r.Core.unimplemented()};loadable.prototype.getReqType=function()
{r.Core.unimplemented()};loadable.prototype.getReqParams=function()
{r.Core.unimplemented()};loadable.prototype.getLoadableData=function()
{return this.loadableData};loadable.prototype.setLoadableData=function(d)
{this.loadableData=d};loadable.prototype.__updateContent=function(callback)
{var self=this,content=this.getContent(),type=this.getReqType(),_date=new Date();this.__cache_time=_date;this.getWidget().getRequester().sendReq(this.getReqType(),this.getReqParams(),function(data)
{if(self.__cache_time!==_date)
{return}
if(data)
{self.setLoadableData(data[type]);self.updateContentByData(self.getLoadableData(),content)}
if(typeof(callback)==="function")
{callback()}})};loadable.prototype.updateContentByData=function(data,content,mark,speed)
{this.updateContent(data,content||this.getContent());this.bindEvents();if(mark)
{this.toggleLoader(!1,!1,speed);this.markNoneUpdate()}};loadable.prototype.getLoader=function()
{if(!this.__loader)
{this.__loader=this.getBodyElement().find(".reservi_entity_loader_wrapper").eq(0)}
return this.__loader};loadable.prototype.getContent=function()
{if(!this.__content)
{this.__content=this.getBodyElement().find(".reservi_step_body_loadable_wrapper").eq(0)}
return this.__content};loadable.prototype.toggleLoader=function(state,callback,s,callback2)
{var self=this,content=this.getContent(),loader=this.getLoader(),a=(state===!0)?content:loader,b=(state===!0)?loader:content,speed=(typeof(s)!=="undefined"&&s!==!1)?s:this.getWidget().getFadeSpeed(),rely=function()
{if(typeof(callback)==="function")
{callback()}};if(speed===0)
{a.hide();b.show();rely();return}
a.fadeOut(speed,function()
{if(!self.isCurrent())
{a.hide()}
if(typeof(callback2)==="function")
{callback2()}
b.fadeIn(speed,rely)})};loadable.prototype.markUpdate=function()
{var self=this;this.__update=!0;if(this.getWidget().getCurrentStep()===this)
{this.toggleLoader(!0,function()
{self.__updateIfNeed()},0)}};loadable.prototype.markNoneUpdate=function()
{this.__update=!1};loadable.prototype.isNeedToUpdate=function()
{return this.__update===!0};loadable.prototype.__updateIfNeed=function(callback,s)
{if(this.isNeedToUpdate())
{this.update(callback,s);return}
if(typeof(callback)==="function")
{callback()}};loadable.prototype.update=function(callback,_s)
{var self=this,bCurrent=this.getWidget().getCurrentStep()===this,speed=(typeof(_s)!=="undefined")?_s:!1;this.toggleLoader(!0,function()
{self.__updateContent(function()
{if(typeof(callback)==="function")
{callback()}
self.toggleLoader(!1,function()
{if(bCurrent)
{self.getWidget().getScroll().update()}},speed,function()
{self.onShowContentUpdated()})})},0);this.markNoneUpdate()};loadable.prototype.proccessBodyTemplate=function(template,data,td)
{return this.super_proccessBodyTemplate(r.Templates.Processor.process(r.Templates.Storage.get("loadable","wrapper"),{'content':template},!1)+r.Templates.Storage.get("loadable","loader"),data,td)};loadable.prototype.onStart=function()
{this.getContent().hide();this.getLoader().show()};loadable.prototype.onBeforeShow=function()
{this.__updateIfNeed()};loadable.prototype.bindEvents=function()
{};loadable.prototype.onShowContentUpdated=function()
{};s.LoadableStep=loadable})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{});(function($,w,r,s,v)
{if(typeof(v.Managed)!=="undefined")
{return}
var managed=function(widget,id,data)
{s.LoadableStep.apply(this,arguments);this.__update=!0;this.loadableData=!1};managed.prototype=Object.create(s.LoadableStep.prototype);managed.prototype.superOnStart=managed.prototype.onStart;managed.prototype.__superBindEvents=managed.prototype.bindEvents;managed.prototype.constructor=managed;managed.prototype.onStart=function()
{this.superOnStart();var w=this.getWidget();w.getStep(w.steps.main).registerManagedStep(this)};managed.prototype.getMainStep=function()
{var w=this.getWidget();return w.getStep(w.steps.main)};managed.prototype.getRelay=function()
{return!1};managed.prototype.getSelected=function()
{r.Core.unimplemented()};managed.prototype.getAvaliable=function()
{r.Core.unimplemented()};managed.prototype.getSetActionOrderData=function()
{r.Core.unimplemented()};managed.prototype.getRemoveActionOrderData=function()
{r.Core.unimplemented()};managed.prototype.getActionStep=function()
{r.Core.unimplemented()};managed.prototype.getRelatedSteps=function()
{r.Core.unimplemented()};managed.prototype.getEntityData=function(id)
{r.Core.unimplemented()};managed.prototype.getManagedId=function()
{r.Core.unimplemented()};managed.prototype.toggleEntity=function(st,id,e,skip)
{var w=(st===!0)?this.getSetActionOrderData():this.getRemoveActionOrderData(),mA=(st===!0)?"addEntityManagedData":"removeEntityManagedData",wid=this.getWidget(),_dat=(st===!0)?this.getEntityData(id):null;if(st===!0&&(!_dat||r.Utils.Object.isEmpty(_dat)))
{throw new r.Exception.EntityNotFound(id)}
this.toggleEntityClass(st,id,e);wid[w](id);this.getMainStep()[mA](this,id,_dat);var rel=this.getRelatedSteps();if(rel&&r.Utils.Array.is(rel)&&rel.length>0)
{r.Utils.Array.iterate(rel,function(_cur)
{var relStep=wid.getStep(_cur);if(relStep&&relStep instanceof s.LoadableStep)
{relStep.markUpdate()}})}
if(skip!==!0)
{wid.selectStep(this.getActionStep())}
this.onEntityToggled()};managed.prototype.onEntityToggled=function()
{};managed.prototype.toggleEntityClass=function(st,id,e)
{var el=(e)?e:this.getEntityElement(id),c=(st===!0)?"addClass":"removeClass";if(st===!0)
{var _id=this.getEventId(),_w=this.getWidget();if(_id)
{_w.sendEvent(_id,id)}}
el[c]("reservi_widget_managed_entity_selected")};managed.prototype.selectEntity=function(id,e,skip)
{this.toggleEntity(!0,id,e,skip)};managed.prototype.deselectEntity=function(id,e,skip)
{this.toggleEntity(!1,id,e,skip)};managed.prototype.isActive=function()
{return this.getSelected().length>0};managed.prototype.isEntitySelected=function(id)
{return this.getSelected().indexOf(id)!==-1};managed.prototype.clickEntity=function(e)
{var id=e.attr("data-entity-id"),a;if(typeof(id)==="undefined")
{r.Core.error("Entity has no id")}
a=(this.isEntitySelected(id))?"deselectEntity":"selectEntity";this[a](id,e)};managed.prototype.getEntityElement=function(id)
{return this.getContent().find("[data-managed-entity][data-entity-id='"+id+"']")};managed.prototype.bindEvents=function()
{this.__superBindEvents();var self=this;this.getContent().find("[data-managed-entity]").unbind("click.managed").bind("click.managed",function()
{self.clickEntity($(this))});var cur=this.getSelected()||[];if(cur.length>0)
{r.Utils.Array.iterate(cur,function(_cur)
{self.toggleEntityClass(!0,_cur)})}};managed.prototype.getEventId=function()
{return!1};managed.prototype.getReqParams=function()
{return this.getWidget().getOrderData()||{}};v.Managed=managed})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r,c)
{if(typeof(c.Component)!=="undefined")
{return}
var component=function(widget)
{if(!widget)
{r.Core.error("There is no widget object")}
this.widget=widget};component.prototype.getWidget=function()
{return this.widget};component.prototype.destroy=function()
{};c.Component=component})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Components=window.ReserviCloud.Components||{});(function($,w,r,s,v)
{if(typeof(v.ManagedSingle)!=="undefined")
{return}
var single=function(widget,id,data)
{v.Managed.apply(this,arguments)};single.prototype=Object.create(v.Managed.prototype);single.prototype.constructor=single;single.prototype.superSelectEntity=single.prototype.selectEntity;single.prototype.getCurrent=function()
{r.Core.unimplemented()};single.prototype.selectEntity=function()
{var cur=this.getCurrent();if(cur)
{this.deselectEntity(cur,!1,!0)}
this.superSelectEntity.apply(this,arguments)};v.ManagedSingle=single})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r,v,m)
{if(typeof(m.Abstract)!=="undefined")
{return}
abstract=function(widget)
{this.__widget=widget};abstract.prototype.getWidget=function()
{return this.__widget};abstract.prototype.destroy=function()
{this.getWidget().unregisterVisitParamsManager()};abstract.prototype.getParams=function()
{r.Core.unimplemented()};abstract.prototype.run=function(callback)
{var self=this,_w=this.getWidget(),data=$.extend({},this.getParams()),_run={run:function()
{if(typeof(callback)==="function")
{callback()}
self.destroy()}};if(!data||r.Utils.Object.isEmpty(data))
{_run.run();return}
if(data.time)
{data.times=data.time;delete data.time}
_w.getRequester().sendReq("configuration",data,function(_res)
{_w.disableCookie();var _acc={"services":r.Steps.Visit.Services,"staff":r.Steps.Visit.Masters,"times":r.Steps.Visit.Times},_data=_res.configuration||{};r.Utils.Object.iterate(_acc,function(_curStep,k)
{if(_data[k])
{var _step=_w.getStep(_curStep);_step.updateContentByData(_data[k],!1,!0,0);var _parms=r.Utils.Array.is(data[k])?data[k]:[data[k]];try
{r.Utils.Array.iterate(_parms,function(_curParam)
{_step.selectEntity(_curParam)});_step.markNoneUpdate()}
catch(e)
{_step.markUpdate()}}});_w.enableCookie();_run.run()})};abstract.isActive=function(widget)
{r.Core.unimplemented()};m.Abstract=abstract})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.VisitParams=window.ReserviCloud.VisitParams||{},window.ReserviCloud.VisitParams.Manager=window.ReserviCloud.VisitParams.Manager||{});(function($,w,r,t)
{if(t.Template)
{return}
var template=function()
{};template.prototype.compile=function()
{r.Core.unimplemented()};t.Template=template})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Templates=window.ReserviCloud.Templates||{});(function($,w,r,u,s)
{var summVisibleHeight=function(items)
{var summ=0;if(items&&items.length>0)
{r.Utils.Array.iterate(items,function(v)
{summ+=v.filter(":visible").height()||0})}
return summ};if(s.Abstract)
{return}
var abstract=function(widget,element,speed)
{this.widget=widget;this.element=element;this.speed=speed||widget.getFadeSpeed();this.window=$(w)};abstract.prototype.getWidget=function()
{return this.widget};abstract.prototype.getElement=function()
{return this.element};abstract.prototype.getWindow=function()
{return this.window};abstract.prototype.getSpeed=function()
{return this.speed};abstract.prototype.update=function()
{var _w=this.getWidget();this.getElement().css({height:this.getWindow().height()-(summVisibleHeight([_w.getHeader(),_w.getPrePadd(),_w.getFooter()]))});this.updateScroll()};abstract.prototype.isScrollable=function()
{return this.getContentHeight()>this.getHeight()};abstract.prototype.getHeight=function()
{r.Core.unimplemented()};abstract.prototype.getContentHeight=function()
{r.Core.unimplemented()};abstract.prototype.updateScroll=function()
{r.Core.unimplemented()};abstract.prototype.getPos=function()
{r.Core.unimplemented()};abstract.prototype.getElementPos=function(e)
{r.Core.unimplemented()};abstract.prototype.scrollTo=function(pos,s)
{r.Core.unimplemented()};abstract.prototype.scrollToElement=function(e,s)
{r.Core.unimplemented()};abstract.prototype.scrollDelta=function(delta,speed)
{this.scrollTo(this.getPos()+Math.floor(delta),speed||0)};s.Abstract=abstract})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.UI=window.ReserviCloud.UI||{},window.ReserviCloud.UI.Scroller=window.ReserviCloud.UI.Scroller||{});(function($,w,r,s,o)
{if(typeof(o.AOrder)!=="undefined")
{return}
order=function(rWidget,rId,data)
{s.Abstract.apply(this,arguments)};order.prototype=Object.create(s.Abstract.prototype);order.prototype.constructor=order;order.prototype.__superAOrderOnStart=order.prototype.onStart;order.prototype.onStart=function()
{this.__superAOrderOnStart();this.__order_order=this.getWidget().getOrder()};order.prototype.getOrder=function()
{return this.__order_order};o.AOrder=order})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Order=window.ReserviCloud.Steps.Order||{});(function($,w,r,v,m)
{if(typeof(m.Cookie)!=="undefined")
{return}
var generateName=function(salon)
{return "reservi_prev_session_"+r.Utils.String.hash(salon)},__cache={},getCookie=function(widget)
{var id=widget.getSalon();if(typeof(__cache[id])==="undefined")
{var _dat=r.Utils.Cookie.getJSON(generateName(widget.getSalon()));__cache[id]=_dat||{}}
return __cache[id]},saveCookie=function(widget,time)
{r.Utils.Cookie.setJSON(generateName(widget.getSalon()),widget.getOrderData()||{},time);clearCache(widget)},clearCache=function(widget)
{delete __cache[widget.getSalon()]};clearCookie=function(widget)
{saveCookie(widget,-1);clearCache(widget)};cookie=function(widget)
{m.Abstract.apply(this,arguments)};cookie.prototype=Object.create(m.Abstract.prototype);cookie.prototype.constructor=cookie;cookie.prototype.getParams=function()
{return getCookie(this.getWidget())||{}};cookie.isActive=function(widget)
{var _data=getCookie(widget);return _data&&!r.Utils.Object.isEmpty(_data)};cookie.saveCache=function(widget)
{saveCookie(widget,15)};cookie.clear=function(widget)
{clearCookie(widget)};m.Cookie=cookie})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.VisitParams=window.ReserviCloud.VisitParams||{},window.ReserviCloud.VisitParams.Manager=window.ReserviCloud.VisitParams.Manager||{});(function($,r,u)
{if(u.DateTime)
{return}
var calcDayOfWeek=function(d,dW,weeks,wd)
{var res=new Date(d.getTime()),weekFactor=(weeks)?weeks:0,_wd=(typeof(wd)!=="undefined")?wd:d.getDay();res.setDate(d.getDate()+(weekFactor*7)+(dW-_wd)%7);return res},twoDigits=function(n)
{return("0"+n).slice(-2)};u.DateTime={weekDays:{sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},getDayOfWeek:function(d,dW,weeks)
{return calcDayOfWeek(d,dW,weeks)},getDayOfWeekOffsetName:function(d,weekStart,dw,weeks)
{var o=(weekStart||"sunday").toLowerCase();return this.getDayOfWeekOffset(d,this.weekDays[o],dw,weeks)},getDayOfWeekOffset:function(d,weekStart,dw,weeks)
{return calcDayOfWeek(d,dw,weeks,(d.getDay()+7-weekStart)%7)},getDayOfWeekEurope:function(d,dw,weeks)
{return this.getDayOfWeekOffset(d,1,dw,weeks)},getToday:function()
{var d=new Date();d.setHours(0,0,0,0);return d},toISO:function(d)
{return[[d.getFullYear(),twoDigits(d.getMonth()+1),twoDigits(d.getDate())].join("-"),[twoDigits(d.getHours()),twoDigits(d.getMinutes()),twoDigits(d.getSeconds())].join(":")].join("T")},fromISO:function(d)
{var t=(this.isOffsetInString(d))?d:d+this.getTimeZone();return new Date(Date.parse(t))},isOffsetInString:function(d)
{return d.indexOf("Z")!==-1||d.indexOf("GMT")!==-1||d.match(/([\-\+](\d{2})\:(\d{2}))/)},getTimeZone:function()
{var offset=new Date().getTimezoneOffset(),o=Math.abs(offset);return(offset<0?"+":"-")+("00"+Math.floor(o/60)).slice(-2)+":"+("00"+(o%60)).slice(-2)},minutesToString:function(minutes)
{var hours=Math.floor(minutes/60);var minutesS=Math.floor(minutes%60);if(hours>0&&minutesS>0)
{return hours+" "+r.Lang.getMessage("datetime_hours")+" "+minutesS+" "+r.Lang.getMessage("datetime_minutes")}
else if(hours>0)
{return hours+" "+r.Lang.getMessage("datetime_hours")}
else{return minutesS+" "+r.Lang.getMessage("datetime_minutes")}}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,w,r,u,b)
{if(b.Abstract)
{return}
var abstract=function(widget,data)
{this.__widget=widget;this.__data=data||{};this.__init(arguments)};abstract.prototype.getData=function(k)
{return(k)?this.__data[k]:this.__data};abstract.prototype.__init=function()
{this.__register();this.__build()};abstract.prototype.__register=function()
{this.getWidget().registerBanner(this)};abstract.prototype.__build=function()
{var _w=this.getWidget(),_s=_w.getFadeSpeed();_w.getPrePadd().html(r.Templates.Processor.process(r.Templates.Storage.get('instance','banner'),{'content':this.getContent()}));this.getElement().hide().fadeIn(_s,function()
{_w.getScroll().update()});this.bindEvents()};abstract.prototype.bindEvents=function()
{var self=this,_w=this.getWidget(),element=this.getElement(),_s=_w.getFadeSpeed();element.find("[data-banner-close]").unbind("click").bind("click",function()
{self.onBeforeDestroy();element.slideUp(_s,function()
{self.destroy()})})};abstract.prototype.getContent=function()
{r.Core.unimplemented()};abstract.prototype.getElement=function()
{if(!this.__element)
{this.__element=this.getWidget().getPrePadd().find("[data-banner]")}
return this.__element};abstract.prototype.getWidget=function()
{return this.__widget};abstract.prototype.destroy=function(before)
{var _w=this.getWidget(),pre=_w.getPrePadd(),scroll=_w.getScroll();if(before)
{this.onBeforeDestroy(!0)}
pre.html("");_w.unregisterBanner();scroll.update();this.onDestroy()};abstract.prototype.onBeforeDestroy=function(bForce)
{};abstract.prototype.onDestroy=function()
{};b.Abstract=abstract})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.UI=window.ReserviCloud.UI||{},window.ReserviCloud.UI.Banner=window.ReserviCloud.UI.Banner||{});(function($,r,u)
{if(u.String)
{return}
u.String={suffix:function($n,$forms)
{if(typeof($forms)==="string")
{$forms=$forms.split("|")}
if(Number($n)!==$n)
{return $forms[1]}
$n=Math.abs($n)%100;var $n1=$n%10;if($n>10&&$n<20)
{return $forms[2]}
if($n1>1&&$n1<5)
{return $forms[1]}
if($n1===1)
{return $forms[0]}
return $forms[2]},escapeRegEx:function(reg)
{return reg.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},replace:function(str,find,replace)
{return str.replace(new RegExp(this.escapeRegEx(find),'g'),replace)},isMail:function(a)
{return/^[=_.0-9a-z+~-]+@(([-0-9a-z_]+\.)+)([a-z]{2,10})$/i.test(a)},hash:function(a)
{var str=String(a),hash=0,i,chr;if(str.length===0)
return hash;for(i=0;i<str.length;i++)
{chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0}
return hash}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,r,u)
{var _agent,getAgent=function()
{if(!_agent)
{var userAgent=navigator.userAgent||navigator.vendor||window.opera;if(/windows phone/i.test(userAgent))
{_agent="windows_phone"}
else if(/(a|A)ndroid/i.test(userAgent))
{_agent="android"}
else if(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream)
{_agent="ios"}
else{_agent="unknown"}}
return _agent};if(u.Client)
{return}
u.Client={isMobile:function()
{var check=!1;(function(a)
{if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge|maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm(os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp(i|ip)|hs\-c|ht(c(\-||_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac(|\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt(|\/)|klon|kpt|kwc\-|kyo(c|k)|le(no|xi)|lg(g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-||o|v)|zz)|mt(50|p1|v)|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v)|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-|)|webc|whit|wi(g|nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))
check=!0})(navigator.userAgent||navigator.vendor||window.opera);return check},isAndroid:function()
{return getAgent()==="android"},isIOS:function()
{return getAgent()==="ios"},isWindows:function()
{return getAgent()==="windows_phone"},getAgent:function()
{return getAgent()}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,r,u)
{if(u.Uri)
{return}
u.Uri={getDomain:function(url)
{var match=url.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);if(match!==null&&match.length>2&&typeof match[2]==='string'&&match[2].length>0)
{return match[2]}
return null},getLinkParameters:function(url)
{if(typeof(url)!=="string")
return!1;var paramString=(url.indexOf("?")===-1)?url:url.split('?')[1],ret=[],arVars=[],_cache={},_tick=0;arVars=paramString.split("&");for(var i=0;i<arVars.length;i++)
{if(arVars[i]&&typeof(arVars[i])!=="undefined")
{var result=arVars[i].split("=",2),bAr=result[0].indexOf("[]")!==-1,name=result[0].replace("[]","");if(!(bAr&&typeof(_cache[name])!=="undefined"))
{ret.push({key:name,value:(bAr)?[result[1]]:result[1]});if(bAr)
{_cache[name]=_tick}
_tick++}
else{ret[_cache[name]].value.push(result[1])}}}
return ret},getLinkParameter:function(url,param)
{var urlParams=this.getLinkParameters(url);for(var i=0;i<urlParams.length;i++)
{var result=urlParams[i];if(result.key===param)
{return result.value}}
return!1},getPageParameters:function()
{return this.getLinkParameters(window.location.search.slice(1))},getPageParameter:function(param)
{return this.getLinkParameter(window.location.search.slice(1),param)},getLinkParamsByKeyPreg:function(url,preg)
{var $return=[];var ar=this.getLinkParameters(url);for(var i=0;i<ar.length;i++)
{var current=ar[i];var key=current.key;if(key.match(preg))
{$return.push(current)}}
return $return},getPageParamsByKeyPreg:function(preg)
{return this.getLinkParamsByKeyPreg(window.location.search.slice(1),preg)},buildLinkParams:function(params)
{var $return=[];if(params&&u.Array.is(params)&&params.length>0)
{for(var i=0;i<params.length;i++)
{var current=params[i];if(current.key)
{var value=(typeof(current.value)!=="undefined")?current.value:"";$return.push(current.key+"="+value)}}}
return $return.join("&")},array_to_parameter:function(array,parameter)
{var result=[];for(var i=0;i<array.length;i++)
{result.push(parameter+"[]="+encodeURIComponent(array[i]))}
return result.join("&")}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,w,r,v,m)
{if(typeof(m.Query)!=="undefined")
{return}
var _params=["staff","service","services","dates","times"],cache=!1,proccessParams=function()
{if(!cache)
{var _p=r.Utils.Uri.getPageParameters();cache={};r.Utils.Array.iterate(_p,function(_curK,k)
{if(_curK.key&&_curK.value&&_params.indexOf(_curK.key)!==-1)
{cache[_curK.key]=_curK.value}});if(cache.service)
{if(!cache.services)
{cache.services=[]}
if(!r.Utils.Array.is(cache.service))
{cache.service=[cache.service]}
r.Utils.Array.iterate(cache.service,function(val)
{cache.services.push(val)});delete cache.service}}
return cache};query=function(widget)
{m.Abstract.apply(this,arguments)};query.prototype=Object.create(m.Abstract.prototype);query.prototype.constructor=query;query.prototype.getParams=function()
{return proccessParams()};query.isActive=function(widget)
{return!r.Utils.Object.isEmpty(proccessParams())};m.Query=query})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.VisitParams=window.ReserviCloud.VisitParams||{},window.ReserviCloud.VisitParams.Manager=window.ReserviCloud.VisitParams.Manager||{});(function($,r,u)
{if(u.Object)
{return}
u.Object={isEmpty:function(obj)
{if(typeof(obj)==="undefined")
{return!0}
for(var prop in obj)
{if(obj.hasOwnProperty(prop))
{return!1}}
return JSON.stringify(obj)===JSON.stringify({})},iterate:function(object,$func)
{if(typeof(object)==="object"&&typeof($func)==="function")
{for(var property in object)
{if(object.hasOwnProperty(property))
{if($func(object[property],property)===!1)
{break}}}}},length:function(a)
{var b=0;this.iterate(a,function()
{b++});return b},find:function(obj,func)
{for(var k in obj)
{if(obj.hasOwnProperty(k)&&func(obj[k])===!0)
{return obj[k]}}},sort:function(obj,func)
{var result={},keysSorted=Object.keys(obj).sort(function(a,b)
{if(obj.hasOwnProperty(a)&&obj.hasOwnProperty(b))
{return func(a,b,obj)}});for(var i=0;i<keysSorted.length;i++)
{result[keysSorted[i]]=obj[keysSorted[i]]}
return result},inObject:function(obj,v)
{return this.find(obj,function(f)
{return f===v})!==null},column:function(obj,columnName,skipNull)
{var result=[];this.iterate(obj,function(item)
{if(!(skipNull&&!item[columnName]))
{result.push(item[columnName])}});return result}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,r,u)
{if(u.Array)
{return}
u.Array={is:function(arr)
{return Array.isArray(arr)},in_array:function(needle,array)
{if(this.is(array))
{for(var i=0;i<array.length;i++)
{if(typeof(needle)==="function")
{if(needle(array[i]))
return i}
else{if(array[i]===needle)
return i}}}
return!1},filter:function(array,func)
{var Arr=[];for(var i=0;i<array.length;i++)
{if(typeof(func)==="function")
{if(func(array[i],i))
Arr.push(array[i])}
else{if(typeof(array[i])!=="undefined"&&array[i])
Arr.push(array[i])}}
return Arr},remove:function(array,index)
{var ar=array;ar.splice(index,1);return ar},find:function(arr,callback)
{var k=this.index_callback(arr,callback);return(k!==!1)?arr[k]:!1},index_callback:function(arr,callback)
{var res=!1;this.iterate(arr,function(_cur,k)
{if(callback(_cur,k)===!0)
{res=k;return!1}});return res},iterate:function(arr,callback)
{for(var k=0;k<arr.length;k++)
{if(callback(arr[k],k)===!1)
{break}}},intersections:function(a,b)
{return this.filter(a,function(_a)
{return b.indexOf(_a)!==-1})},chunk:function(a,s)
{var res=[];for(var i=0,j=a.length;i<j;i+=s)
{res.push(a.slice(i,i+s))}
return res}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,r,u)
{if(u.jQuery)
{return}
var sanitizeElements=function(elements)
{var result=null;if(elements instanceof $)
result=elements;else if(elements.length)
{for(var k=0;k<elements.length;k++)
{if(result==null)
result=elements[k];else result=result.add(elements[k])}}
return result},fadeMultiple=function(elements,action,momentAction,speed,func)
{var $elements=sanitizeElements(elements),length=$elements.length;if(!length)
return;if(!speed&&momentAction)
{$elements[momentAction]();func&&func();return}
var faded=0,incrementer=function()
{faded++;if(faded>=length)
func&&func()};$elements[action](speed,incrementer)};u.jQuery={fadeIn:function(elements,speed,func)
{fadeMultiple(elements,'fadeIn','show',speed,func)},fadeOut:function(elements,speed,func)
{fadeMultiple(elements,'fadeOut','hide',speed,func)}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,r,u)
{if(u.Element)
{return}
u.Element={getAttributesMap:function(element)
{var $return={};if(element&&element.length>0)
{var attributes=element[0].attributes;for(var i=0;i<attributes.length;i++)
{var attribute=attributes[i];$return[attribute.nodeName]=attribute.value}}
return $return},getDataAttributesMap:function(element)
{var $return={};var attributes=this.getAttributesMap(element);for(var prop in attributes)
{if(attributes.hasOwnProperty(prop))
{if(prop.indexOf("data-")!==-1)
{$return[prop.replace("data-","")]=attributes[prop]}}}
return $return},changeTag:function(element,tag,bContent,callback)
{var e=$(element);$.each(e,function(){})}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,r,u)
{if(u.Cookie)
{return}
u.Cookie={set:function(cname,cvalue,_min)
{var d=new Date(),min=(typeof(_min)!=="undefined")?_min:(60*24*30*12);d.setTime(d.getTime()+(min*60*1000));var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/"},get:function(cname)
{var name=cname+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++)
{var c=ca[i];while(c.charAt(0)===' ')
{c=c.substring(1)}
if(c.indexOf(name)===0)
{return c.substring(name.length,c.length)}}
return ""},setJSON:function(cname,cvalue,min)
{try
{this.set(cname,encodeURIComponent(JSON.stringify(cvalue)),min)}
catch(e){}},getJSON:function(cname)
{try
{return JSON.parse(decodeURIComponent(this.get(cname)))}
catch(e){}}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,r,u)
{if(u.Interval)
{return}
u.Interval={walker:function(s,t,f1,f2)
{var k=0,_i=setInterval(function()
{k++;if(k>=t)
{clearInterval(_i);if(typeof(f2)==="function")
{f2()}
return}
if(typeof(f1)==="function")
{f1(k,t-k)}},s);f1(k,t-k);return _i},clear:function(v)
{clearInterval(v)}}})(jQuery,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Utils=window.ReserviCloud.Utils||{});(function($,w,r,s,o)
{if(typeof(o.Order)!=="undefined")
{return}
var order=function(rWidget,rId,data)
{o.AOrder.apply(this,arguments)};order.prototype=Object.create(o.AOrder.prototype);order.prototype.constructor=order;order.prototype.__superOrderOnStart=order.prototype.onStart;order.prototype.__superOrderOnBeforeShow=order.prototype.onBeforeShow;order.prototype.__superOrderOnBeforeHide=order.prototype.onBeforeHide;order.prototype.__superOrderOnDestroy=order.prototype.onDestroy;order.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("order")};order.prototype.getBodyData=function(data,td)
{var _d=(data)?data:{},_w=this.getWidget();_d.notify=!!_w.getSalonData("notify");_d.use_promocod=!!_w.getSalonData("promocod");_d.email=!!_w.isEmail();return _d};order.prototype.getHeadData=function(data,td)
{return{}};order.prototype.getPrevStep=function()
{return s.Main};order.prototype.getButton=function()
{if(!this.__order_button)
{this.__order_button=new r.UI.Button.Loader(this.getBodyElement().find("[data-order-button]"))}
return this.__order_button};order.prototype.getPolicy=function()
{if(!this.__order_policy)
{this.__order_policy=this.getBodyElement().find("[data-order-accept]")}
return this.__order_policy};order.prototype.getNotify=function()
{if(!this.__notify)
{this.__notify=this.getBodyElement().find("[data-order-notify-select]")}
return this.__notify};order.prototype.getBuildElement=function()
{if(!this.__elBuilding)
{this.__elBuilding=this.getBodyElement().find("[data-order-build]")}
return this.__elBuilding};order.prototype.getComment=function()
{if(!this.__elComment)
{this.__elComment=this.getBodyElement().find("[data-order-comment]")}
return this.__elComment};order.prototype.getPromocod=function()
{if(!this.__promocod)
{this.__promocod=this.getBodyElement().find("[data-order-promocod]")}
return this.__promocod};order.prototype.getAuthName=function()
{if(!this.__authName)
{this.__authName=this.getBodyElement().find('[data-auth-name]')}
return this.__authName};order.prototype.getAuthPhone=function()
{if(!this.__authPhone)
{this.__authPhone=this.getBodyElement().find('[data-auth-phone]')}
return this.__authPhone};order.prototype.getAuthEmail=function()
{if(!this.__authEmail)
{this.__authEmail=this.getBodyElement().find('[data-auth-email]')}
return this.__authEmail};order.prototype.getError=function()
{if(!this.__errorField)
{this.__errorField=this.getBodyElement().find("[data-order-error]")}
return this.__errorField};order.prototype.getSmsForm=function()
{if(!this.__smsForm)
{this.__smsForm=this.getBodyElement().find("[data-sms-form]")}
return this.__smsForm};order.prototype.showError=function(error)
{this.getError().html(error||'').show()};order.prototype.hideError=function()
{this.getError().html('').hide()};order.prototype.onStart=function()
{this.__superOrderOnStart();var not=this.getNotify(),self=this,_o=this.getOrder(),_w=this.getWidget(),_btnO=this.getButton(),_btn=_btnO.getElement(),_comment=this.getComment(),_form=this.getBodyElement().find(".reservi_widget-formsendsms"),_vP=_o.getPhone(),_oP=this.getAuthPhone(),_vN=_o.getName(),_oN=this.getAuthName(),_place=_w.getPlaceHolderPhoneMaskString(),_error=this.getBodyElement().find("[data-auth-errormsg]"),_mask=_w.getPhoneMaskString(),_bEmail=_w.isEmail(),_oEmail=(_bEmail)?this.getAuthEmail():!1,_vEmail=(_bEmail)?_o.getEmail():!1,fadeSpeed=_w.getFadeSpeed();not.selectboxReservi();not.bind("dropdown dropup",function(e)
{var _m=(e.type==="dropdown")?$(this).prev(".selectbox").find(".dropdown").height():0;_form.css("margin-bottom",_m+"px");_w.getScroll().update()});_oP.inputmaskReservi({mask:_mask,placeholder:_place,clearIncomplete:!0,selectOnFocus:!0}).attr("data-placeholder",_place).attr("placeholder",_place);var _c={f:function(s,t)
{t.attr("placeholder",(s)?t.attr("data-placeholder"):"")}};_oP.bind("blur focus mouseleave",function(e)
{_c.f(e.type==="blur"||e.type==="mouseleave",$(this))});if(_vP)
{if(InputmaskReservi.isValid(InputmaskReservi.format(_vP,_mask),_mask))
{_oP.inputmaskReservi("setvalue",_vP)}}
if(_vN)
{_oN.val(_vN).trigger("change")}
if(_bEmail&&_vEmail)
{_oEmail.val(_vEmail).trigger("change")}
if(!_o.isAuthorized())
{this.showAuth()}
else{this.hideAuth()}
this.hideSmsConfirm(null,!0);_btnO.offClick("order").onClick("order",function()
{var orderFunc=function()
{_btnO.run();self.makeOrder(function(data)
{self.getError().text("").hide();var finishUrl=_w.getSalonData("finish-url");if(finishUrl&&finishUrl.length&&finishUrl.indexOf('http')!==-1)
{window.location.href=finishUrl;return}
_w.selectStep(o.Success,null,{price:data.price,"messages":data.messages})},function(error)
{if(error.reauth===!0)
{self.showAuth();return}
self.getError().text(error.Message||r.Lang.getMessage("order_make_error")).show();_btnO.stop()},function()
{})};if(!_o.isAuthorized())
{self.makeAuth(function(data)
{self.hideAuthOrder(function()
{self.showSmsConfirm(function()
{_btnO.run();self.showButton(fadeSpeed);orderFunc()})});self.hideError()},function(data)
{self.hideAuthOrder(null,!0);self.hideError();_btnO.run();orderFunc()},function(data)
{self.showError(r.Lang.getMessage('order_auth_error'))},function()
{self.hideError();_btnO.run()},function()
{_btnO.stop()});return}
orderFunc()})};order.prototype.showAuth=function(speed)
{this.__setAuthFieldsVisible(!0,speed)};order.prototype.hideAuth=function(speed,func)
{this.__setAuthFieldsVisible(!1,speed,func)};order.prototype.showComment=function(speed)
{this.getComment().fadeIn(speed)};order.prototype.hideComment=function(speed,func)
{this.getComment().fadeOut(speed,func)};order.prototype.showButton=function(speed,func)
{r.Utils.jQuery.fadeIn([this.getButton().getElement(),this.getPolicy()],speed,func)};order.prototype.hideButton=function(speed,func)
{r.Utils.jQuery.fadeOut([this.getButton().getElement(),this.getPolicy()],speed,func)};order.prototype.showAuthOrder=function(instant)
{var speed=instant?0:this.getWidget().getFadeSpeed();!this.getOrder().isAuthorized()&&this.showAuth(speed);this.showComment(speed);this.showButton(speed)};order.prototype.hideAuthOrder=function(func,instant)
{var faded=0,speed=instant?0:this.getWidget().getFadeSpeed(),incrementer=function()
{faded++;if(faded>=3)
func&&func()};this.hideAuth(speed,incrementer);this.hideComment(speed,incrementer);this.hideButton(speed,incrementer)};order.prototype.__setAuthFieldsVisible=function(state,speed,func)
{var elements=[this.getAuthName(),this.getAuthPhone()];if(this.getWidget().isEmail())
elements.push(this.getAuthEmail());r.Utils.jQuery[state?'fadeIn':'fadeOut'](elements,speed,func)};order.prototype.showSmsConfirm=function(onConfirm)
{var speed=this.getWidget().getFadeSpeed(),form=this.getSmsForm().html(r.Templates.Processor.process(this.getTemplate('sms-form')||"",{})).fadeIn(speed),_o=this.getOrder(),waiter=form.find("[data-authsms-waiting-seconds]"),seconds=waiter.find("[data-authsms-seconds]"),button=new r.UI.Button.Loader(form.find("[data-authsms-new]"));this.__smsData={counter:null,form:form,phone:form.find("[data-authsms-phone]"),button:button,buttonWrapper:button.getElement().parents("[data-authsms-new-parent]"),waiter:waiter,seconds:seconds,input:form.find("[data-authsms-sms]"),backer:form.find("[data-authsms-change]"),status:form.find("[data-authsms-status]")};var self=this,counterFunc=function()
{self.__smsData.buttonWrapper.hide();self.__smsData.waiter.show();self.__smsData.counter=r.Utils.Interval.walker(1000,30,function(a,b)
{self.__smsData.seconds.text(b+" "+r.Utils.String.suffix(b,r.Lang.getMessage("datetime_seconds_after_suffix")))},function()
{self.__smsData.waiter.fadeOut(speed,function()
{self.__smsData.buttonWrapper.fadeIn(speed)})});self.__smsData.input.focus()};this.__smsData.button.onClick("btn_new_code",function()
{this.run();var _btn=this;_o.requestSms(function()
{_btn.stop();counterFunc()})});this.__smsData.phone.text(_o.getPhone()||"");this.__smsData.status.hide();this.__smsData.backer.unbind("click").bind("click",function()
{self.hideSmsConfirm(function()
{self.showAuthOrder()})});this.__smsData.input.removeAttr("disabled");this.__smsData.input.bind("keydown keyup change",function(e)
{if(self.__authorized===!0)
{return}
var t=$(this),_iVal=t.val()||"",val=_iVal.trim().substring(0,4),bVal=(val&&val.length>0);if(bVal&&val.length>=4)
{t.val("");t.attr("disabled","disabled");_o.requestAuth(val,function(_res)
{var _error=(_res!==!0);self.__smsData.status[(_error)?"show":"hide"]();if(_error)
{t.removeAttr("disabled");return}
t.focusout();self.__authorized=!0;self.hideSmsConfirm();onConfirm&&onConfirm()})}});counterFunc()};order.prototype.hideSmsConfirm=function(func,instant)
{var speed=instant?0:this.getWidget().getFadeSpeed(),form=this.getSmsForm();form.fadeOut(speed,function()
{form.html("");func&&func()});this.clearSmsData()};order.prototype.clearSmsData=function()
{if(this.__smsData!=null&&this.__smsData.counter!=null)
r.Utils.Interval.clear(this.__smsData.counter);delete this.__smsData};order.prototype.makeOrder=function(success,error,complete)
{var order=this.getOrder();order.setComment(this.getComment().val()||"");order.setNotify(this.getNotify().val()||!1);order.setPromocod(this.getPromocod().val()||!1);this.getOrder().makeOrder(success,error,complete)};order.prototype.makeAuth=function(successSms,successAuthed,error,start,complete)
{var _o=this.getOrder(),_w=this.getWidget(),_oP=this.getAuthPhone(),_oN=this.getAuthName(),_error=this.getBodyElement().find("[data-auth-errormsg]"),_bEmail=_w.isEmail(),_oEmail=(_bEmail)?this.getAuthEmail():!1,er=!1,_class="reservi-input-error",_eEls=_oP.add(_oN);if(_bEmail)
{_eEls=_eEls.add(_oEmail)}
_eEls.each(function()
{var t=$(this),v=t.val(),bLength=!v||v.length<=0,bError=(_bEmail&&t.is(_oEmail))?!bLength&&!r.Utils.String.isMail(v):bLength;if(bError)
{t.addClass(_class);er=!0}
else{t.removeClass(_class)}});if(er)
{return}
_o.setName(_oN.val());_o.setPhone(_oP.val());if(_bEmail)
{_o.setEmail(_oEmail.val())}
_error.hide();typeof start==="function"&&start();_o.requestSms(function(res)
{typeof complete==="function"&&complete();if(res==="sms")
{typeof successSms==="function"&&successSms(res)}
else if(res===!0)
{typeof successAuthed==="function"&&successAuthed(res)}
else{typeof error==="function"&&error(res)}})};order.prototype.onBeforeShow=function(prev)
{this.__superOrderOnBeforeShow(prev);var _b=this.getBodyElement(),_o=this.getOrder(),_w=this.getWidget(),_valute=_w.getSalonValute(),maxPrice=0,minPrice=0,totalLength=0,_stepMaster=_w.getStep(_w.steps.masters),_stepService=_w.getStep(_w.steps.services),_stepTime=_w.getStep(_w.steps.times),_valueMaster=_stepMaster.getCurrent(),_valueService=_stepService.getSelected(),_masterName=(_valueMaster)?_stepMaster.getEntityData(_valueMaster)['master_name']:r.Lang.getMessage("main_entity_staff_"+_w.getRedaction()),_servicesData=[],bFirst=!0;r.Utils.Array.iterate(_valueService,function(_cur)
{var cur=_stepService.getEntityData(_cur),_curData={"service-length":cur["service-duration"],"service-valute":_valute,"service-price":cur["service-price"],"service-name":cur["service-title"],"master-name":_masterName,"service-start-time":!1};if(bFirst)
{var selected=_stepTime.getSelected();if(selected)
{_curData["service-start-time"]=(_stepTime.getEntityData(selected)||{})["display"]||""}}
_servicesData.push(_curData);maxPrice+=cur["service-price-max"];minPrice+=cur["service-price-min"];totalLength+=cur["service-duration-int"];bFirst=!1});var _dat={name:_o.getName(),"services":new r.Templates.ListTemplate(this.getTemplate("services"),_servicesData),"total-price":((maxPrice!==minPrice)?minPrice+" - "+maxPrice:minPrice)+_valute,"total-length":r.Utils.DateTime.minutesToString(totalLength)};_o.setOrderSum((maxPrice===minPrice)?minPrice:!1);this.getBuildElement().html(r.Templates.Processor.process(this.getTemplate("compile"),_dat));this.getError().text("").hide()};order.prototype.onBeforeHide=function(next)
{this.__superOrderOnBeforeHide(next);this.clearSmsData()};order.prototype.onDestroy=function()
{this.__superOrderOnDestroy();this.clearSmsData()};o.Order=order})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Order=window.ReserviCloud.Steps.Order||{});(function($,w,r,s,v)
{if(typeof(v.Services)!=="undefined")
{return}
var services=function(widget,id,data)
{v.Managed.apply(this,arguments);this.refreshData();this.__updateRel=!1};services.prototype=Object.create(v.Managed.prototype);services.prototype.superBindEvents=services.prototype.bindEvents;services.prototype.superServicesOnEntityToggled=services.prototype.onEntityToggled;services.prototype.__superServicesOnBeforeShow=services.prototype.onBeforeShow;services.prototype.constructor=services;services.prototype.isFiltering=function()
{if(typeof(this.__fix_multiple_services)==="undefined")
{this.__fix_multiple_services=!0}
return this.__fix_multiple_services};services.prototype.refreshData=function()
{this.services={};this.categories={}};services.prototype.getEntityData=function(id)
{return this.services[id]||{}};services.prototype.getManagedId=function()
{return "services"};services.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("services")};services.prototype.getBodyData=function(data,td)
{return{}};services.prototype.getHeadData=function(data,td)
{return{}};services.prototype.getPrevStep=function()
{return s.Main};services.prototype.getReqType=function()
{return "service"};services.prototype.getSelected=function()
{return this.getWidget().getServices()};services.prototype.getAvaliable=function()
{return Object.keys(this.services)||[]};services.prototype.getSetActionOrderData=function()
{return "addService"};services.prototype.getRemoveActionOrderData=function()
{return "removeService"};services.prototype.onEntityToggled=function()
{this.superServicesOnEntityToggled();if(this.isFiltering()&&this.getCurrentIntersect().length>0||this.getSelected().length===0)
{this.__updateRel=!0}};services.prototype.onBeforeShow=function(prev)
{this.__superServicesOnBeforeShow(prev);if(this.isFiltering()&&!this.isNeedToUpdate()&&this.__updateRel===!0)
{this.__updateRel=!1;var self=this;this.toggleLoader(!0,function()
{self.updateContentByData(self.__unfilterServices,self.getContent());self.toggleLoader(!1)},5)}};services.prototype.getActionStep=function()
{return this.getPrevStep()};services.prototype.getRelatedSteps=function()
{var w=this.getWidget();return[w.steps.masters,w.steps.dates,w.steps.times]};services.prototype.getCurrentIntersect=function()
{var cur=this.getSelected(),_selectedIntersect=!1;if(cur||cur.length>0)
{var self=this;r.Utils.Array.iterate(cur,function(_s)
{var _c=self.services[_s];if(_c&&_c["enabled-services"].length>0)
{_selectedIntersect=(_selectedIntersect!==!1)?r.Utils.Array.intersections(_selectedIntersect,_c["enabled-services"]):_c["enabled-services"]}})}
return _selectedIntersect||[]};services.prototype.filterServices=function(services)
{if(this.isFiltering())
{var _inter=this.getCurrentIntersect();if(_inter.length>0)
{_used=_inter.concat(this.getSelected());var _d={};r.Utils.Object.iterate(services,function(cur,k)
{if(_used.indexOf(cur["service-id"])!==-1)
{_d[k]=cur}});services=_d}}
return services};services.prototype.updateContent=function(data,content)
{var html="",services={},categories={},uncategory={},self=this;if(data&&(r.Utils.Array.is(data)&&data.length>0)||(typeof(data)==="object"&&!r.Utils.Object.isEmpty(data)))
{var iterator=(r.Utils.Array.is(data))?r.Utils.Array.iterate:r.Utils.Object.iterate;iterator(data,function(current,k)
{if(data[k].active===!0)
{var item=(current["service-id"])?current:{"active":!0,"service-id":current.id,"service-title":current.title||"","service-comment":current.comment||"","service-price":(current.price_max&&current.price_min&&current.price_max!==current.price_min)?r.Lang.getMessage("services_price_between",{"#from#":current.price_min,"#to#":current.price_max}):current.price_min,"service-price-min":current.price_min,"service-price-max":current.price_max,"service-category":(current.category)?current.category.id:!1,"service-category-title":(current.category)?current.category.title:r.Lang.getMessage("services_uncategory"),"enabled-services":current.ServicesAtSameTime||[],"service-valute":self.getWidget().getSalonValute(),"service-duration":r.Utils.DateTime.minutesToString(current.length),"service-duration-int":current.length||0};services[item["service-id"]]=item}})}
this.__unfilterServices=services;var _services=this.filterServices(services);this.refreshData();this.services=_services;r.Utils.Object.iterate(this.services,function(current,k)
{var bCategory=current["service-category"]!==!1;if(bCategory)
{if(!categories[current["service-category"]])
{categories[current["service-category"]]={category_id:current["service-category"],category_title:current["service-category-title"],items:[]}}
categories[current["service-category"]].items.push(current)}
else{if(!uncategory.category_id)
{uncategory={category_id:"others",category_title:current["service-category-title"],items:[]}}
uncategory.items.push(current)}});this.categories=categories;if(uncategory&&uncategory.items)
{this.categories.others=uncategory}
var countCategories=0;r.Utils.Object.iterate(this.categories,function(_cur,k)
{countCategories++;self.categories[k].category_items=new r.Templates.ListTemplate(r.Templates.Storage.get("services","service"),self.categories[k].items)});html=r.Templates.Processor.process(r.Templates.Storage.get("services","compile"),{"categories":new r.Templates.ListTemplate(r.Templates.Storage.get("services",countCategories>1?"category":"unCategory"),this.categories)});content.html(html)};services.prototype.bindEvents=function()
{this.superBindEvents();var content=this.getContent(),self=this,widget=self.getWidget(),speed=widget.getFadeSpeed();content.find(".reservi_widget_service_category > a").unbind("click").bind("click",function(e,fast)
{var t=$(this),scroll=widget.getScroll(),li=t.parent("[data-services-category]"),ul=li.parent("[data-categories-container]"),liUl=li.children("[data-services-container]"),bActive=!li.is(".reservi_widget-servactive"),position=(bActive)?widget.getScroll().getElementPos(t)-li.prevAll(".reservi_widget-servactive").children("[data-services-container]").height():!1,mnimic=!1;if(fast)
{var speed=0}
li.toggleClass('reservi_widget-servactive');li.siblings("[data-services-category].reservi_widget-servactive").removeClass("reservi_widget-servactive").find("[data-services-container]").slideToggle(speed);var pos=(bActive)?position:!1;if(!widget.isMob())
{var bScrollable=scroll.isScrollable(),scrollHeight=scroll.getHeight(),contentHeight=scroll.getContentHeight(),ulHeight=liUl.height();if(bActive)
{if(scrollHeight<=position+ulHeight)
{ul.css("padding-bottom",ulHeight);mnimic=!0;scroll.update()}}
else if(bScrollable&&contentHeight-ulHeight<=scrollHeight)
{pos=0}}
if(pos!==!1)
{scroll.scrollTo(pos)}
liUl.slideToggle(speed,function()
{if(mnimic)
{ul.css("padding-bottom",0)}
scroll.update()})})};services.prototype.getEventId=function()
{return 'service'};v.Services=services})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r,s,v)
{if(typeof(v.Master)!=="undefined")
{return}
var master=function(widget,id,data)
{s.LoadableStep.apply(this,arguments);this.__master=!1;this.__updatehead=!0};master.prototype=Object.create(s.LoadableStep.prototype);master.prototype.master_super_onBeforeShow=master.prototype.onBeforeShow;master.prototype.constructor=master;master.prototype.setMaster=function(id)
{if(this.__master!==id)
{this.__master=id;this.markUpdate();this.__updatehead=!0}};master.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("master")};master.prototype.getHeadData=function()
{return{}};master.prototype.getBodyData=function()
{return{}};master.prototype.getPrevStep=function()
{return s.Visit.Masters};master.prototype.updateContent=function(data,content)
{var html="",self=this;if(data)
{r.Utils.Array.iterate(data,function(cur,k)
{var total=0;if(cur.ratings&&cur.ratings.length>0)
{var sum=0;r.Utils.Array.iterate(cur.ratings,function(_rate)
{sum+=_rate.rating});total=sum/cur.ratings.length}
html+=r.Templates.Processor.process(self.getTemplate("comment"),{comment_author:(cur.client)?cur.client.name:"",comment_date:cur.post_time,comment_text:cur.text,comment_rating:new r.Templates.Star(total)})})}
content.find("[data-master-comments]").html(html)};master.prototype.getReqType=function()
{return "comments"};master.prototype.getReqParams=function()
{return{staff:this.__master||!1}};master.prototype.__updateBtnText=function(e)
{var w=this.getWidget(),m=w.getStep(w.steps.masters),selected=m.getCurrent()===this.__master,toggler=(e)?e:this.getHeaderElement().find("[data-master-toggle][data-master-id]"),msg=(selected)?"master_action_deselect":"master_action_select";toggler.text(r.Lang.getMessage(msg))};master.prototype.onBeforeShow=function()
{this.master_super_onBeforeShow();if(this.__master)
{var w=this.getWidget(),m=w.getStep(w.steps.masters),bind=!1,self=this,toggler;if(this.__updatehead)
{this.getHeaderElement().html(r.Templates.Processor.process(this.getTemplate("_head"),$.extend({},m.getEntityData(this.__master))));this.__updatehead=!1;bind=!0}
if(bind)
{var header=this.getHeaderElement();toggler=header.find("[data-master-toggle][data-master-id]");toggler.bind("click.master_select",function()
{var t=$(this),id=t.attr("data-master-id"),cur=m.getCurrent()===id,action=(cur)?"deselectEntity":"selectEntity";m[action](id);self.__updateBtnText(t)});header.find('[data-show-info]').bind('click.master_info',function()
{m.showMasterInfo($(this).attr('data-master-id'))})}
this.__updateBtnText(toggler)}};v.Master=master})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r)
{if(r.Order)
{return}
var __params={phone:"phone",name:"name",email:"mail",token:"user_secret"},__orderParams={phone:"phone",name:"name",email:"mail",token:"user_secret",comment:"comment",notify:"notify",promocod:"promo"},localStorageKey="order_user_tokens",generateCookieName=function(n)
{return "reservi_order_data_"+r.Utils.String.hash(n)};var order=function(widget)
{this.__widget=widget;this.__orderData={};this.__visitData={};this.proccessParams()};order.prototype.getCookieName=function()
{if(!this.__cookieName)
{this.__cookieName=generateCookieName(this.getWidget().getSalon())}
return this.__cookieName};order.prototype.proccessParams=function()
{var _w=this.getWidget(),_c=r.Utils.Cookie.getJSON(this.getCookieName()),_p=r.Utils.Uri.getPageParameter("phone"),restore=(_c)?_c:!1,self=this;if(!restore&&_p)
{restore={};restore[__params.phone]=_p}
if(restore&&!r.Utils.Object.isEmpty(restore))
{r.Utils.Object.iterate(restore,function(_v,k)
{if(_v&&r.Utils.Object.inObject(__params,k))
{self.setData(k,_v)}})}};order.prototype.getWidget=function()
{return this.__widget};order.prototype.start=function(callback)
{var _w=this.getWidget(),self=this,token=this.getToken(),c={f:function()
{_w.selectStep(r.Steps.Order.Order);if(typeof(callback)==="function")
{callback()}}};if(token&&!self.isTokenCached(token))
{_w.getRequester().sendReq(["check_token"],{userToken:token},function(data)
{var bUpdated=data.check_token!==!0;if(bUpdated)
{self.addCachedToken(token);self.setToken(!1)}
c.f(!bUpdated)});return}
c.f(!!token)};order.prototype.saveCache=function(t)
{r.Utils.Cookie.setJSON(this.getCookieName(),this.__orderData,t||(this.getWidget().isMob()?518400:43200))};order.prototype.setOrderSum=function(s)
{this.__ordersum=s};order.prototype.getOrderSum=function()
{return this.__ordersum||!1};order.prototype.clearCache=function()
{r.VisitParams.Manager.Cookie.clear(this.getWidget())};order.prototype.setData=function(a,b)
{this.__orderData[a]=b||!1;this.saveCache()};order.prototype.setName=function(v)
{this.setData(__orderParams.name,v)};order.prototype.setPhone=function(v)
{this.setData(__orderParams.phone,v)};order.prototype.setEmail=function(v)
{this.setData(__orderParams.email,v)};order.prototype.setToken=function(v)
{this.setData(__orderParams.token,v)};order.prototype.setComment=function(v)
{this.setData(__orderParams.comment,v||"")};order.prototype.setNotify=function(v)
{this.setData(__orderParams.notify,v||!1)};order.prototype.setPromocod=function(v)
{this.setData(__orderParams.promocod,v||!1)};order.prototype.getData=function(a)
{return(a)?this.__orderData[a]:this.__orderData};order.prototype.getName=function()
{return this.getData(__orderParams.name)};order.prototype.getPhone=function()
{return this.getData(__orderParams.phone)};order.prototype.getEmail=function()
{return this.getData(__orderParams.email)};order.prototype.getToken=function()
{return this.getData(__orderParams.token)};order.prototype.getComment=function()
{return this.getData(__orderParams.comment)};order.prototype.getNotify=function()
{return this.getData(__orderParams.notify)};order.prototype.getPromocod=function()
{return this.getData(__orderParams.promocod)};order.prototype.setVisitData=function(d)
{this.__visitData=d||{}};order.prototype.requestSms=function(f)
{this.__sendAuth({ph:this.getPhone()},f)};order.prototype.requestAuth=function(c,f)
{this.__sendAuth({ph:this.getPhone(),conf_code:c||""},f)};order.prototype.__sendAuth=function(d,f)
{if(typeof(f)!=="function")
{return}
var self=this;this.getWidget().getRequester().sendReq("auth",d,function(data)
{var _r=!1;if(data&&data.auth)
{if(data.auth.sent_SMS)
{_r="sms"}
else if(data.auth.UserToken)
{_r=!0;self.setToken(data.auth.UserToken);self.addCachedToken(data.auth.UserToken)}}
f(_r)})};order.prototype.getStaffName=function()
{var _w=this.getWidget(),_s=_w.getStep(_w.steps.masters),_v=_s.getCurrent(),_dat=(_v)?_s.getEntityData(_v):!1;return(_dat&&_dat.master_name)?_dat.master_name:r.Lang.getMessage("main_entity_staff_"+_w.getRedaction())};order.prototype.getRecordInfo=function()
{var _w=this.getWidget(),_s=_w.getStep(_w.steps.services),_current=_s.getSelected(),_names=[],summ=0;r.Utils.Array.iterate(_current,function(_v)
{var _d=_s.getEntityData(_v);if(_d&&_d["service-title"])
{_names.push(_d["service-title"])}
summ+=_d["service-price-min"]});return{phone:this.getPhone(),staff:this.getStaffName(),summ:summ,services:_names}};order.prototype.getRecordArray=function()
{var _dat=[],_w=this.getWidget(),_mastersStep=_w.getStep(_w.steps.masters),_timeStep=_w.getStep(_w.steps.times),_servicesStep=_w.getStep(_w.steps.services),_timeV=r.Utils.DateTime.fromISO(_timeStep.getCurrent()),_staff=_mastersStep.getCurrent(),_services=_servicesStep.getSelected();r.Utils.Array.iterate(_services,function(cur,k)
{var _serviceData=_servicesStep.getEntityData(cur);_dat.push({datetime:r.Utils.DateTime.toISO(_timeV),service_id:cur,staff_id:_staff||""});_timeV.setMinutes(_timeV.getMinutes()+Number(_serviceData["service-duration-int"]))});return _dat};order.prototype.makeOrder=function(success,error,complete)
{var _w=this.getWidget(),self=this,_data={fullname:this.getName()||"",comment:this.getComment()||"",promo:this.getPromocod()||"",userToken:this.getToken(),commercial:encodeURIComponent(r.Widget.getSiteSourceCompain())||"",notify_by_sms:this.getNotify()||"",record_info:this.getRecordInfo(),record_array:this.getRecordArray()};if(_w.isEmail())
{var email=this.getEmail();if(email)
{_data.email=email}}
_w.getRequester().send("order",_data,function(data)
{if(data&&data.Result===!0)
{self.clearCache();_w.sendEvent("order",_data);if(typeof(success)==="function")
{success(data)}}
else if(typeof(error)==="function")
{error(data)}
if(typeof(complete)==="function")
{complete(data)}})};order.prototype.getCachedTokens=function()
{return this.getWidget().getLocalStorage().get(localStorageKey)||[]};order.prototype.isTokenCached=function(token)
{return this.getCachedTokens().indexOf(token)!==-1};order.prototype.addCachedToken=function(token)
{this.getWidget().getLocalStorage().push(localStorageKey,token)};order.prototype.isAuthorized=function()
{return!!this.getToken()};r.Order=order})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{});(function($,w,r)
{if(r.Assets)
{return}
r.Assets={load:function(assets,callback)
{var __load=$.extend({},assets),length=r.Utils.Object.length(__load),bC=typeof(callback)==="function",i=-1,_c={f:function(a)
{i++;if(bC&&i>=length)
{callback()}}};r.Utils.Object.iterate(__load,function(cur,k)
{var cur=__load[k],loader=k==="js"?r.Loader.Js:r.Loader.Css;if(cur)
{loader.loadList([cur],_c.f)}});_c.f()}}})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{});(function($,w,r,u,s)
{if(s.Pane)
{return}
var pane=function(widget,element,speed)
{s.Abstract.apply(this,arguments);this.pane=this.getElement().jScrollPaneReservi().data('jsp')};pane.prototype=Object.create(s.Abstract.prototype);pane.prototype.constructor=pane;pane.prototype.getPaneElement=function()
{if(!this.__pane_element)
{this.__pane_element=this.getElement().find(".jspPane")}
return this.__pane_element};pane.prototype.isScrollable=function()
{return this.getPane().getIsScrollableV()};pane.prototype.getHeight=function()
{return this.getElement().height()};pane.prototype.getContentHeight=function()
{return this.getPane().getContentHeight()};pane.prototype.getPane=function()
{return this.pane};pane.prototype.updateScroll=function()
{this.getPane().reinitialise();if(!this.isScrollable()&&this.getPos()>0)
{this.getPaneElement().css({top:"0px"})}};pane.prototype.getPos=function()
{return this.getPane().getContentPositionY()};pane.prototype.getElementPos=function(e)
{return this.getPos()+e.offset().top-this.getElement().offset().top};pane.prototype.scrollTo=function(pos,s)
{this.getPane().scrollToY(pos,s!==0,{animateDuration:(typeof(s)!=="undefined")?s:this.getSpeed()})};pane.prototype.scrollToElement=function(e,s)
{this.getPane().scrollToElement(e,s!==0,{animateDuration:(typeof(s)!=="undefined")?s:this.getSpeed()})};s.Pane=pane})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.UI=window.ReserviCloud.UI||{},window.ReserviCloud.UI.Scroller=window.ReserviCloud.UI.Scroller||{});(function($,w,r,s,v)
{if(typeof(v.Masters)!=="undefined")
{return}
var masters=function(widget,id,data)
{v.Managed.apply(this,arguments);this.__mastersDates={};this.__mastersByOldWay=!1;this.refreshData()};masters.prototype=Object.create(v.ManagedSingle.prototype);masters.prototype.superBindEvents=masters.prototype.bindEvents;masters.prototype.constructor=masters;masters.prototype.refreshData=function()
{this.masters={}};masters.prototype.getSetActionOrderData=function()
{return "setStaff"};masters.prototype.getRemoveActionOrderData=function()
{return "unsetStaff"};masters.prototype.getActionStep=function()
{return this.getPrevStep()};masters.prototype.getCurrent=function()
{return this.getWidget().getStaff()};masters.prototype.getSelected=function()
{var cur=this.getCurrent();return(cur)?[cur]:[]};masters.prototype.getAvaliable=function()
{return Object.keys(this.masters)||[]};masters.prototype.getEntityData=function(id)
{return this.masters[id]};masters.prototype.getManagedId=function()
{return "masters"};masters.prototype.getReqType=function()
{return "staff"};masters.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("masters")};masters.prototype.getBodyData=function(data,td)
{return{}};masters.prototype.getHeadData=function(data,td)
{return{masters_select_master_head:r.Lang.getMessage("masters_head_entity_"+this.getWidget().getRedaction())}};masters.prototype.getPrevStep=function()
{return s.Main};masters.prototype.getRelatedSteps=function()
{var w=this.getWidget();return[w.steps.services,w.steps.dates,w.steps.times]};masters.prototype.updateContent=function(data,content)
{var result="",widget=this.getWidget(),self=this,aboutLang=r.Lang.getMessage("masters_info_entity_"+this.getWidget().getRedaction());this.masters={};if(data)
{r.Utils.Array.iterate(data,function(cur)
{if(cur)
{var rate="";if(cur.ratings&&cur.ratings.length>0)
{var summ=0,count=0,rates=0;for(var j=0;j<cur.ratings.length;j++)
{summ+=cur.ratings[j].rating*cur.ratings[j].votes_count;count+=cur.ratings[j].votes_count;rates+=Math.round(cur.ratings[j].votes_count)||0}
rate=new r.Templates.Star((count>0)?summ/count:0)}
if(typeof(self.__mastersDates[cur.id])==="undefined"&&typeof(cur.upcoming_dates)!=="undefined")
{self.__mastersDates[cur.id]=cur.upcoming_dates}
var commentsInfo=[];if(rates)
commentsInfo.push(rates+" "+r.Utils.String.suffix(rates,r.Lang.getMessage("masters_rates_suffix")));if(cur.comments_count)
commentsInfo.push(cur.comments_count+" "+r.Utils.String.suffix(cur.comments_count,r.Lang.getMessage("masters_comments_suffix")));self.masters[cur.id]={"master_id":cur.id,"master_name":cur.name,"master_avatar":(cur.avatar)?widget.getDomain()+cur.avatar:!1,"master_specialization":(cur.specialization)?cur.specialization.title:"","master_rating":rate,"master_info":cur.information||"","master_information_title":aboutLang,"master_comments":commentsInfo.join(", ")}}});result=r.Templates.Processor.process(this.getTemplate("compile"),{masters:new r.Templates.ListTemplate(this.getTemplate("master"),this.masters)})}
content.html(result);this.__updateMastersDates()};masters.prototype.__updateMastersDates=function()
{var __update=[],self=this;r.Utils.Object.iterate(this.masters,function(cur,k)
{var id=cur.master_id;if(typeof(self.__mastersDates[id])==="undefined")
{__update.push(id)}});if(__update.length>0)
{this.getWidget().getRequester().sendReq("staffsinfo",{"staffs":__update},function(data)
{if(data&&data.staffsinfo)
{r.Utils.Object.iterate(data.staffsinfo,function(cur,j)
{self.__mastersDates[j]=cur})}
self.__buildMastersDates()});return}
this.__buildMastersDates()};masters.prototype.__buildMastersDates=function()
{var self=this;this.getContent().find("[data-managed-entity][data-entity-id]").each(function()
{var t=$(this),id=t.attr("data-entity-id");if(id&&self.__mastersDates[id]&&self.__mastersDates[id].length>0)
{t.find("[data-master-dates]").html(r.Templates.Processor.process(self.getTemplate("dates"),{"dates":new r.Templates.ListTemplate(self.getTemplate("date"),self.__mastersDates[id])}));self.getWidget().getScroll().update();self.getContent().find("[data-master-date]").unbind("click.master_date").bind("click.master_date",function(e)
{var t=$(this),_el=t.parents("[data-managed-entity][data-entity-id]"),id=_el.attr("data-entity-id"),_w=self.getWidget(),_t=_w.getStep(_w.steps.times);_t.setData("prev-step",self);self.selectEntity(id,_el,!0);_t.selectDay(t.attr("data-date-dmy"),!0);_w.selectStep(_t,null,{skip:!0});e.stopPropagation()})}})};masters.prototype.bindEvents=function()
{this.superBindEvents();var self=this;this.getContent().find("[data-show-master], [data-show-master-info]").unbind("click.show_master").bind("click.show_master",function(e)
{var tis=$(this),showComments=tis.is('[data-show-master]'),m=tis.parents("[data-managed-entity][data-entity-id]").attr("data-entity-id");if(!m)
{r.Core.error("Cant find master id")}
self[showComments?'showMasterComments':'showMasterInfo'](m);e.stopPropagation()})};masters.prototype.showMasterComments=function(masterId)
{this.showMasterDetailStep(masterId,s.Visit.Master)};masters.prototype.showMasterInfo=function(masterId)
{this.showMasterDetailStep(masterId,s.Visit.MasterInfo)};masters.prototype.showMasterDetailStep=function(masterId,step)
{var w=this.getWidget(),_step=w.getStep(step);if(!(_step instanceof s.Visit.MasterInfo)&&!(_step instanceof s.Visit.Master))
{r.Core.error("wrong step")}
_step.setMaster(masterId);w.selectStep(_step)};masters.prototype.getEventId=function()
{return 'staff'};v.Masters=masters})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r,u,s)
{if(s.Browser)
{return}
var browser=function(widget,element,speed)
{s.Abstract.apply(this,arguments)};browser.prototype=Object.create(s.Abstract.prototype);browser.prototype.constructor=browser;browser.prototype.getHeight=function()
{return this.getElement()[0].clientHeight};browser.prototype.getContentHeight=function()
{return this.getElement()[0].scrollHeight};browser.prototype.updateScroll=function()
{var widget=this.getWidget();this.getElement().css("max-height",widget.getElement().height()-(widget.getHeader().height()+(widget.getFooterState()?widget.getFooter().height():0)))};browser.prototype.getPos=function()
{return this.getElement().scrollTop()};browser.prototype.getElementPos=function(e)
{return this.getPos()+e.offset().top-this.getElement().offset().top};browser.prototype.scrollTo=function(pos,s)
{this.getElement().animate({scrollTop:pos},(typeof(s)!=="undefined")?s:this.getSpeed())};browser.prototype.scrollToElement=function(e,s)
{this.scrollTo(this.getElementPos(e),s)};s.Browser=browser})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.UI=window.ReserviCloud.UI||{},window.ReserviCloud.UI.Scroller=window.ReserviCloud.UI.Scroller||{});(function($,w,r,u,b)
{if(b.Loader)
{return}
var _class="reservi_widget_ui_btn_loader",_running="reservi_widget_ui_btn_loader_running";var loader=function(_el)
{this._el=$(_el);this.init()};loader.prototype.getElement=function()
{return this._el};loader.prototype.init=function()
{this.getElement().addClass(_class)};loader.prototype.run=function()
{this.getElement().addClass(_running);this.__running=!0;return this};loader.prototype.stop=function()
{this.getElement().removeClass(_running);this.__running=!1;return this};loader.prototype.toggle=function()
{this.getElement().toggleClass(_running);return this};loader.prototype.offClick=function(t)
{this.getElement().unbind("click"+ +((t)?"."+t:""));return this};loader.prototype.onClick=function(a,b)
{var _f=(a&&!b)?a:b,_n=(!!b)?a:"";if(typeof(_f)!=="function")
{return}
var self=this;this.getElement().bind("click"+((_n)?"."+_n:""),function()
{if(self.__running!==!0)
{_f.apply(self,arguments)}});return this};b.Loader=loader})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.UI=window.ReserviCloud.UI||{},window.ReserviCloud.UI.Button=window.ReserviCloud.UI.Button||{});(function($,w,r,u,b)
{if(b.App)
{return}
var app=function(widget,data)
{b.Abstract.apply(this,arguments)};app.prototype=Object.create(b.Abstract.prototype);app.prototype.constructor=app;app.prototype.__superAppOnBeforeDestroy=app.prototype.onBeforeDestroy;app.prototype.getContent=function()
{var _d=this.getData();return r.Templates.Processor.process(r.Templates.Storage.get("instance","app-banner"),{image:_d.image,name:_d.name,url:_d.url,descr:_d.description,name_descr:(_d.description)?_d.name+" - "+_d.description:_d.name,download:r.Lang.getMessage("app_download_"+_d.agent)||r.Lang.getMessage("app_download")||""})};app.prototype.onBeforeDestroy=function(b)
{this.__superAppOnBeforeDestroy(b);if(!b)
{r.Utils.Cookie.set(app.getCookieName(this.getWidget().getSalon(),this.getData("agent")),"Y",1440*30)}};app.getCookieName=function(salon,agent)
{return "reservi_salon_"+salon+"_"+agent};app.init=function(widget,_app)
{var app=_app||{},agent=r.Utils.Client.getAgent();if(app[agent]&&r.Utils.Cookie.get(this.getCookieName(widget.getSalon(),agent))!=="Y")
{new this(widget,$.extend({},app[agent],{"agent":agent}))}};b.App=app})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.UI=window.ReserviCloud.UI||{},window.ReserviCloud.UI.Banner=window.ReserviCloud.UI.Banner||{});(function($,w,r)
{if(r.Ajax)
{return}
r.Ajax={send:function(page,params,callback,type,complete,before,error)
{return $.ajax({url:page,data:params,success:callback,error:error,complete:complete,beforeSend:before,dataType:type,method:"POST",type:"POST"})}}})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{});(function($,w,r,s,v)
{if(typeof(v.Times)!=="undefined")
{return}
var activeClass="reservi_widget-activedate";var times=function(widget,id,data)
{v.Managed.apply(this,arguments);this.setCurrentTimeCache(!1);this.refreshData()};times.prototype=Object.create(v.ManagedSingle.prototype);times.prototype.constructor=times;times.prototype.__superTimeOnBeforeShow=times.prototype.onBeforeShow;times.prototype.__superTimesOnHide=times.prototype.onHide;times.prototype.__superTimesOnEntityToggled=times.prototype.onEntityToggled;times.prototype.getCurrent=function()
{return this.getWidget().getTime()};times.prototype.setCurrentTimeCache=function(v)
{this.time=v||!1};times.prototype.refreshData=function()
{this.__cacheTimes={}};times.prototype.getEntityData=function(id)
{var cur=this.getCurrent();var res=(cur&&id===cur)?this.time:this.__cacheTimes[id];return res||{}};times.prototype.getManagedId=function()
{return "times"};times.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("times")};times.prototype.getBodyData=function(data,td)
{return{}};times.prototype.getHeadData=function(data,td)
{return{}};times.prototype.getPrevStep=function()
{var p=this.getData("prev-step");return(p)?p:s.Visit.Dates};times.prototype.getRelay=function()
{return s.Visit.Dates};times.prototype.getReqType=function()
{return "times"};times.prototype.getSelected=function()
{var res=[],_t=this.getCurrent();if(_t)
{res.push(_t)}
return res};times.prototype.getAvaliable=function()
{return Object.keys(this.__cacheTimes)||[]};times.prototype.getSetActionOrderData=function()
{return "setTime"};times.prototype.getRemoveActionOrderData=function()
{return "unsetTime"};times.prototype.getActionStep=function()
{return s.Main};times.prototype.getRelatedSteps=function()
{var w=this.getWidget();return[w.steps.masters,w.steps.services]};times.prototype.getTimesEmpty=function()
{if(!this.__times_empty)
{this.__times_empty=this.getContent().find("[data-times-empty]")}
return this.__times_empty};times.prototype.getTimesSection=function()
{if(!this.__times_section)
{this.__times_section=this.getContent().find("[data-times-day]")}
return this.__times_section};times.prototype.updateContent=function(data,content)
{var self=this,_empty=this.getTimesEmpty(),_storage=this.getTimesSection(),empty=data===!1||(r.Utils.Array.is(data)&&data.length<=0),a=empty?_empty:_storage,b=empty?_storage:_empty;a.show();b.hide();_storage.html("");if(empty)
{return}
var _sections={};this.refreshData();r.Utils.Array.iterate(data,function(cur,k)
{cur.active=!cur.closed;self.__cacheTimes[cur.datetime]=cur;if(!_sections[cur.section])
{_sections[cur.section]={"section":cur.section,"items":[],"name":r.Lang.getMessage("times_section_"+cur.section)}}
_sections[cur.section].items.push(cur)});r.Utils.Object.iterate(_sections,function(cur,k)
{cur.times=new r.Templates.ListTemplate(self.getTemplate("time"),cur.items)});_storage.html(r.Templates.Processor.process(this.getTemplate("compile"),{"sections":new r.Templates.ListTemplate(this.getTemplate("day-section"),_sections)}))};times.prototype.onEntityToggled=function()
{this.__superTimesOnEntityToggled();var cur=this.getCurrent();if(cur)
{this.setCurrentTimeCache(this.__cacheTimes[cur])}};times.prototype.buildCalendar=function(months)
{if(!this.__calendar&&months&&months.length>0)
{var self=this,_header=this.getHeaderElement(),_e=_header.find("[data-times-nav]"),days=[];r.Utils.Array.iterate(months,function(_month,k)
{var _monthNum=_month.date.getMonth();r.Utils.Array.iterate(_month.items,function(_d,j)
{if(_d.d.getMonth()===_monthNum)
{days.push({month:_month.name,dmy:_d.day_dmy,num:_d.day_num,name:_d["week-name"]})}})});_e.html(r.Templates.Processor.process(this.getTemplate("nav"),{days:new r.Templates.ListTemplate(this.getTemplate("day"),days)}));var _monther=_header.find("[data-times-month]");this.__calendar=_e.find('.reservi_widget-list-date .reservi_widget-list-date-all').slickReservi({dots:!1,infinite:!1,slidesToShow:7,slidesToScroll:4,focusOnSelect:!0,centerMode:!0,prevArrow:_e.find(".reservi_datetime_slider_control.reservi_widget-arrowleft"),nextArrow:_e.find(".reservi_datetime_slider_control.reservi_widget-arrowright"),responsive:[{breakpoint:570,settings:{slidesToShow:5}}]}).bind("beforeChange",function(e,s,c,next)
{if(next===c)
{return}
var t=$(this),tar=t.find(".slick-slide[data-slick-index='"+next+"']"),m=tar.attr("data-time-month"),_d=tar.attr("data-time-date"),_dt=self.parseDate(_d);if(_dt.getTime()<r.Utils.DateTime.getToday().getTime())
{e.preventDefault();return!1}
if(tar.is("."+activeClass))
{self.__selectDay(_d)}
else{self.setClosedDay()}
if(m)
{_monther.text(m)}})}};times.prototype.selectDay=function(day,skip)
{if(!day)
{return}
if(!this.__calendar)
{var self=this,_w=this.getWidget();_w.getStep(_w.steps.dates).update(function()
{self.selectDay(day,skip)});return}
var i=this.__calendar.find("[data-time-date='"+day+"']").attr("data-slick-index");if(typeof(i)!=="undefined")
{this.__calendar.slickReservi("slickGoTo",i,skip)}};times.prototype.__selectDay=function(day)
{var _d=this.parseDate(day);this.getWidget().setDate(this.FormatDate(_d));this.markUpdate()};times.prototype.setClosedDay=function()
{this.updateContent(!1,this.getContent())};times.prototype.parseDate=function(date)
{var parts=date.split(/(\s+)/).filter(function(e)
{return e.trim().length>0}),res=new Date((new Date()).getFullYear(),0,1);if(parts.length>=3)
{res.setFullYear(parseInt(parts[2]));res.setMonth(parseInt(parts[1])-1);res.setDate(parseInt(parts[0]))}
return res};times.prototype.FormatDate=function(date)
{return r.Utils.DateTime.toISO(date)};times.prototype.setActiveDays=function(days)
{var _el=this.__calendar.find(".reservi_widget_daytime_selector");_el.removeClass(activeClass);r.Utils.Array.iterate(days,function(_cur)
{if(_cur.dmy)
{_el.filter("[data-time-date='"+_cur.dmy+"']").addClass(activeClass)}})};times.prototype.onBeforeShow=function(prev)
{this.__superTimeOnBeforeShow(prev);if(this.__calendar)
{var _c=this.__calendar;this.getWidget().getTimeouter().add(function()
{_c.trigger("slick-shake")},30)}};times.prototype.onHide=function(next)
{this.__superTimesOnHide(next);var s=this.getData("prev-step");if(s)
{this.setData("prev-step",!1)}};times.prototype.getEventId=function()
{return 'time'};v.Times=times})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r,t)
{if(t.ListTemplate)
{return}
var list=function(template,items,lang)
{t.Template.apply(this,arguments);this.template=template;this.items=items;this.lang=lang;this.result=!1};list.prototype=Object.create(t.Template.prototype);list.prototype.constructor=list;list.prototype.getTemplate=function()
{return this.template};list.prototype.getItems=function()
{return this.items};list.prototype.getLang=function()
{return this.lang};list.prototype.compile=function()
{if(this.result===!1)
{var result='',self=this,iterator=r.Utils.Array.is(this.items)?r.Utils.Array.iterate:r.Utils.Object.iterate;iterator(this.items,function(_item)
{var data=(_item instanceof list)?_item.compile():_item;result+=t.Processor.process(self.getTemplate(),data,self.getLang())});this.result=result}
return this.result};t.ListTemplate=list})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Templates=window.ReserviCloud.Templates||{});(function($,w,r)
{})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{});(function($,w,r,t)
{if(t.Star)
{return}
var star=function(rate)
{t.Template.apply(this,arguments);this.rate=(rate===0)?0.01:rate;this.result=!1};star.prototype=Object.create(t.Template.prototype);star.prototype.constructor=star;star.prototype.compile=function()
{if(this.result===!1)
{var items=[];for(var i=1;i<6;i++)
{var dif=i-this.rate,val=((this.rate>=i)?1:(dif<1)?1-dif:0);items.push({star_percent:val.toFixed(2)*100})}
this.result=r.Templates.Processor.process(t.Storage.get("main_content","rate-star-block"),{"rating":new r.Templates.ListTemplate(t.Storage.get("main_content","rate-star-star"),items)})}
return this.result};t.Star=star})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Templates=window.ReserviCloud.Templates||{});(function($,w,r,t)
{if(t.Processor)
{return}
var tp=function()
{};tp.prototype.process=function(template,data,lang)
{var result=template||"",expr=new RegExp("\\$\{(([\!])?if\_)?(lang(s)?\_)?([A-Za-z0-9\-\_]+)\}","g"),conditions=[],normal=[],match=null;data=data||{};if(result&&result.length)
{while(match=expr.exec(result))
{if(match)
{var a=match[1]?conditions:normal;a.push(match)}}}
var global=conditions.concat(normal);for(var k=0;k<global.length;k++)
{var matchData=global[k];if(matchData[1])
{(function(matchData)
{var innerIndent=(matchData[3]||"")+matchData[5];result=result.replace(new RegExp("\\$\\{"+(matchData[2]?'\\':"")+(matchData[1]||"")+innerIndent+"\\}(("+"(?!\\$\\{\\/if_"+innerIndent+"\\})"+".|[\r\n])+)\\$\\{\\/if_"+innerIndent+"\\}","g"),function(a,b)
{var realVal=data[matchData[5]];switch(matchData[2])
{case "!":return realVal?"":b;break;default:return realVal?b:"";break}})})(matchData)}
else{if(matchData[3])
{result=r.Utils.String.replace(result,matchData[0],r.Lang.getMessage(matchData[5],{},lang)||"")}
else{if(data[matchData[5]]&&data[matchData[5]]instanceof t.Template)
{data[matchData[5]]=data[matchData[5]].compile()}
result=r.Utils.String.replace(result,matchData[0],typeof(data[matchData[5]]!=="undefined")?data[matchData[5]]:"")}}}
return result};t.Processor=new tp()})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Templates=window.ReserviCloud.Templates||{});(function($,w,r,s)
{if(typeof(s.Main)!=="undefined")
{return}
var bSlick=!1,bAssets=!1;var main=function(widget,id,data)
{s.Abstract.apply(this,arguments);this.__managed={};this.__enabled=!1};main.prototype=Object.create(s.Abstract.prototype);main.prototype.constructor=main;main.prototype.getError=function()
{if(!this.__error)
{this.__error=this.getBodyElement().find("[data-main-error]")}
return this.__error};main.prototype.showError=function(m)
{this.getError().text(m||"").show();this.getWidget().getScroll().update()};main.prototype.hideError=function()
{this.getError().hide();this.getWidget().getScroll().update()};main.prototype.isSalonSelector=function()
{if(typeof(this.is_salons_selector)==="undefined")
{this.is_salons_selector=this.getData("salons_selector")===!0}
return this.is_salons_selector};main.prototype.getButton=function()
{if(!this.__btn)
{this.__btn=new r.UI.Button.Loader(this.getBodyElement().find(".reservi_widget-butorder > a"))}
return this.__btn};main.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("salon")};main.prototype.getBodyData=function(data,td)
{var d=data;d.salon_loader_data_entity=r.Lang.getMessage("salon_loading_on_"+d.redaction);return d};main.prototype.getHeadData=function(data,td)
{return{salon_image_alt:data.salon_name,salon_image:data.salon_image}};main.prototype.init=function()
{if(!this.inited)
{var self=this;var data=this.getData(),d={salon_phone_string:data.salon_phone,salon_adress_string:data.salon_adress,salon_widget_reservi_ru:r.Lang.getMessage("salon_reservi_ru"),salon_widget_work_on:r.Lang.getMessage("salon_work_on_"+data.redaction)},footer=r.Templates.Processor.process(r.Templates.Storage.get("salon","footer"),d);this.getWidget().getElement().find(".reservi_footer_on_start_proccess").each(function()
{var t=$(this);t.html(footer);t.show()});this.toggleLoader(!0,!0);var _dat=(!bSlick)?{"assets":["slick"]}:{};bSlick=!0;this.getWidget().getRequester().send("main",_dat,function(result)
{var content=self.getBodyElement().find(".reservi_salon_main_content");if(!result||result.error)
{content.html(r.Templates.Storage.get("instance","error"));self.toggleLoader(!1);return}
self.getWidget().setSalonData(result["salon-data"]);content.html(r.Templates.Processor.process(r.Templates.Storage.get("main_content","body"),{main_entity_master:r.Lang.getMessage("main_entity_master_"+self.getData("redaction")),main_master_type:r.Lang.getMessage("main_entity_staff_"+self.getData("redaction")),show_staff:self.getWidget().getSalonData("hide-staff")!==!0}));var _cb={func:function()
{if(result.dates)
{var _w=self.getWidget(),_dates=_w.getStep(_w.steps.dates);_dates.updateContentByData(result.dates)}
self.toggleLoader(!1);self.onInited();self.bindEvents()}};var callback=self.getData("callback");if(callback)
{callback(_cb.func)}
else{_cb.func()}});this.inited=!0}};main.prototype.onInited=function()
{};main.prototype.isEnabled=function()
{return this.__enabled};main.prototype.getOrderSteps=function()
{if(!this.__order_steps)
{var _w=this.getWidget(),self=this,_s=_w.getSteps();this.__order_steps=[];r.Utils.Object.iterate(_s,function(_cur,k)
{if(_cur instanceof s.Visit.Managed)
{self.__order_steps.push(_cur)}})}
return this.__order_steps};main.prototype.proccessOrderBtn=function()
{var _s=this.getOrderSteps(),self=this;this.__enabled=!0;r.Utils.Array.iterate(_s,function(_cur,k)
{if(!(_cur instanceof s.Visit.Masters)&&_cur.getSelected().length<=0)
{self.__enabled=!1;return!1}});var action=(!this.__enabled)?"addClass":"removeClass";this.getButton().getElement()[action]("reservi_widjet-noactive")};main.prototype.onStart=function()
{this.getWidget().sendEvent("start");if(!this.isSalonSelector())
{this.init()}};main.prototype.toggleLoader=function(state,callback)
{var content=this.getBodyElement().find(".reservi_salon_main_content"),loader=this.getBodyElement().find(".reservi_salon_loader"),speed=(callback===!0)?0:this.getWidget().getFadeSpeed(),a=(state)?content:loader,b=(state)?loader:content,widget=this.getWidget(),func=(typeof(callback)==="function")?function()
{callback()}:!1;if(speed===0)
{a.hide();b.show();widget.getScroll().update();if(func!==!1)
{func()}
return}
a.fadeOut(speed,function()
{b.fadeIn(speed,function()
{widget.getScroll().update();if(func!==!1)
{func()}})})};main.prototype.onBeforeShow=function(prev)
{if(this.isSalonSelector())
{this.init()}
this.getWidget().toggleFooter(!0);this.getWidget().setTitle(this.getData("salon_name"))};main.prototype.getPrevStep=function()
{if(this.getData("salons_selector")===!0)
{var city=this.getWidget().getStep(s.CitySelector);return city?city:s.SalonSelector}};main.prototype.bindEvents=function()
{var self=this;this.getButton().offClick("reservi_order").onClick("reservi_order",function()
{if(!self.__enabled)
{return}
self.startOrder()})};main.prototype.startOrder=function()
{if(this.__started===!0)
{return}
this.__started=!0;var _w=this.getWidget(),self=this,_c={m:function()
{var _m=_w.getStep(_w.steps.masters),_mV=_m.getCurrent(),_mError=!1,_se=_w.getStep(_w.steps.services);if(!_mError&&_mV)
{_se.__updateIfNeed(function()
{_c.f(_mError)});return}
_c.f(_mError)},f:function(error)
{self.__started=!1;if(!error)
{self.hideError();_w.prepareOrder();_w.getOrder().start(function()
{self.getButton().stop()})}
else{self.showError(error);self.getButton().stop()}}};this.getButton().run();if(!bAssets)
{bAssets=!0;_w.loadAssets(["inputmask","selectbox"],function()
{_c.m()});return}
_c.m()};main.prototype.registerManagedStep=function(step)
{if(!(step instanceof s.Visit.Managed))
{r.Core.error("Step is not instance of Managed")}
var self=this;this.getBodyElement().find("[data-reservi-"+step.getManagedId()+"]").bind("click",function()
{var relay=step.getRelay();self.getWidget().selectStep((relay)?relay:step)})};main.prototype.getEntityManaged=function(step)
{var oStep=(typeof(step)==="string")?this.getWidget().getStep(step):step,type=oStep.getManagedId();if(!this.__managed[type])
{var el=this.getBodyElement().find("[data-reservi-"+type+"]"),m=el.find(".reservi_widget_selected_info");this.__managed[type]={step:oStep,type:type,template:r.Templates.Storage.get("main_content","managed-"+type),element:el,managed:m,selected:[],arrow:el.find(".reservi_widget-arrow")}}
return this.__managed[type]};main.prototype.updateEntitytManagedData=function(step,id,_dat)
{var d=this.getEntityManaged(step);if(d&&id)
{d.managed.find("[data-entity-id='"+id+"']").replaceWith(r.Templates.Processor.process(d.template,$.extend({},_dat)))}};main.prototype.addEntityManagedData=function(step,id,_dat)
{var d=this.getEntityManaged(step);d.managed.append(r.Templates.Processor.process(d.template,$.extend({},_dat)));d.element.addClass("reservi_widget_entity_active");if(!d.arrow.is(".reservi_managed_inited"))
{d.arrow.addClass("reservi_managed_inited reservi_widget-deletecr");d.arrow.bind("click.managed",function(e)
{if(d.selected.length>0)
{d.step.deselectEntity(d.selected[d.selected.length-1])}
e.stopPropagation()})}
if(d.selected.indexOf(id)===-1)
{d.selected.push(id)}};main.prototype.removeEntityManagedData=function(step,id)
{var d=this.getEntityManaged(step);d.managed.children('[data-entity-id="'+id+'"]').remove();var index=d.selected.indexOf(id);if(index!==-1)
{d.selected.splice(index,1)}
if(!d.step.isActive())
{d.element.removeClass("reservi_widget_entity_active");d.arrow.unbind("click.managed");d.arrow.removeClass("reservi_managed_inited reservi_widget-deletecr")}};s.Main=main})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{});(function($,w,r,s,v)
{if(typeof(v.MasterInfo)!=="undefined")
{return}
var master=function(widget,id,data)
{s.Abstract.apply(this,arguments);this._mastersStep=null;this.__master=!1;this.__updatehead=!0};master.prototype=Object.create(s.Abstract.prototype);master.prototype.constructor=master;master.prototype.setMaster=function(id)
{if(this.__master!==id)
{this.__master=id;this.__updatehead=!0}};master.prototype.getMastersStep=function()
{if(this._mastersStep===null)
{this._mastersStep=this.getWidget().getStep(v.Masters)}
return this._mastersStep};master.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("master_info")};master.prototype.getHeadData=function()
{return{}};master.prototype.getBodyData=function()
{return{}};master.prototype.getPrevStep=function()
{return s.Visit.Masters};master.prototype.getMasterData=function(masterId)
{return this.getMastersStep().getEntityData(masterId)};master.prototype.__updateBtnText=function(e)
{var w=this.getWidget(),m=w.getStep(w.steps.masters),selected=m.getCurrent()===this.__master,toggler=(e)?e:this.getHeaderElement().find("[data-master-toggle][data-master-id]"),msg=(selected)?"master_action_deselect":"master_action_select";toggler.text(r.Lang.getMessage(msg))};master.prototype.onBeforeShow=function()
{if(this.__master)
{var body=this.getBodyElement(),m=this.getMastersStep(),masterData=this.getMasterData(this.__master)||{},bind=!1,self=this,toggler;body.find('[data-master-description]').html(masterData.master_info||"");if(this.__updatehead)
{this.getHeaderElement().html(r.Templates.Processor.process(this.getTemplate("_head"),$.extend({},masterData)));this.__updatehead=!1;bind=!0}
if(bind)
{var header=this.getHeaderElement();toggler=header.find("[data-master-toggle][data-master-id]");toggler.bind("click.master_select",function()
{var t=$(this),id=t.attr("data-master-id"),cur=m.getCurrent()===id,action=(cur)?"deselectEntity":"selectEntity";m[action](id);self.__updateBtnText(t)});header.find('[data-show-comments]').bind('click.master_info',function()
{m.showMasterComments($(this).attr('data-master-id'))})}
this.__updateBtnText(toggler)}};v.MasterInfo=master})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r,s)
{if(typeof(s.SalonSelector)!=="undefined")
{return}
var oW=$(w),prevData=!1,sortSalons=function(data)
{var res=data;return r.Utils.Object.sort(res,function(a,b,obj)
{return obj[a].name.localeCompare(obj[b].name)})};var selector=function(widget,id,data)
{if(arguments[2].data)
{arguments[2].data=sortSalons(arguments[2].data);prevData=arguments[2].data}
else if(arguments[2].restore&&prevData)
{arguments[2].data=prevData}
s.Abstract.apply(this,arguments)};selector.prototype=Object.create(s.Abstract.prototype);selector.prototype.constructor=selector;selector.prototype.__superOnHideSelector=selector.prototype.onHide;selector.prototype.isCalledByCitySelector=function()
{return!!this.getParams("city")};selector.prototype.onNullTemplate=function()
{var tpl=r.Templates.Storage.get("salons");if(!tpl)
{r.Core.error("There is no salons template")}
return tpl};selector.prototype.getPostContentContainer=function()
{if(!this.__post_content_cointainer)
{this.__post_content_cointainer=this.getWidget().createPostContentContainer()}
return this.__post_content_cointainer};selector.prototype.onStart=function()
{this.__map_commands=[];var self=this,_w=this.getWidget();this.getBodyElement().find(".widget_salon_selector_salon").bind("click",function()
{var data=r.Widget.getSalonElementParams($(this));self.getWidget().initSalon(data.salon,data.params)}).each(function()
{var t=$(this),salon=t.attr("data-salon");r.Widget.buildSalonAttributes(t,self.getData(salon))});if(r.show_map)
{var scroller=_w.getScroll(),salonsXMLS=r.Utils.Object.column(this.getData()||{},"XML_ID",!0),origin=(location.origin)?location.origin:w.location.protocol+"//"+w.location.hostname+(w.location.port?':'+w.location.port:''),mapData={"salons-frame-url":_w.getUri()+"map.php?widget=Y&"+r.Utils.Uri.array_to_parameter(salonsXMLS,"salon")+"&org="+(_w.getOrganization()||"")+"&top="+encodeURIComponent(origin)};if(scroller instanceof r.UI.Scroller.Pane)
{mapData["salons-frame-url"]+='&send_scroll=y'}
if(_w.getStep(s.CitySelector))
{mapData["salons-frame-url"]+='&city=y';this.showCities()}
this.getMapWrapper().append(r.Templates.Processor.process(this.getTemplate("map"),mapData))}};selector.prototype.getMapWrapper=function()
{return this.getPostContentContainer()};selector.prototype.getPostContentElement=function()
{return this.getPostContentContainer()};selector.prototype.onBeforeShow=function(prev)
{var _w=this.getWidget(),redaction=!1;r.Utils.Object.iterate(this.getData(),function(a)
{if(a.redaction)
{redaction=a.redaction;return!1}});this.beforeStepChangeFooter(prev);this.toggleCities(this.getParams('city'));_w.setTitle(r.Lang.getMessage("salons_select_"+(redaction||"salon")));_w.sendEvent("organization",this.salonsXML)};selector.prototype.getSalonItems=function()
{if(!this.__cache_salon_items)
{this.__cache_salon_items=this.getBodyElement().find('[data-salon]')}
return this.__cache_salon_items};selector.prototype.toggleCities=function(city)
{var units=this.getSalonItems(),unitsIds=!1;if(city)
{unitsIds=[];units.hide().filter('[data-salon-city="'+city+'"]').show().each(function()
{var t=$(this);unitsIds.push(t.attr('data-salon'))})}
else{units.show()}
this.selectMapSalons(unitsIds)};selector.prototype.selectMapSalons=function(units)
{this.sendMapCommand("center",{salons:units})};selector.prototype.selectCity=function(city)
{if(city)
{var _w=this.getWidget(),items=this.getSalonItems().filter('[data-salon-city="'+city+'"]');if(items.length===1)
{items.trigger("click");return}
_w.selectStep(this,null,{city:city})}};selector.prototype.beforeStepChangeFooter=function(prev)
{if(!prev||(!(prev instanceof selector)&&!(prev instanceof s.CitySelector)))
{var _w=this.getWidget();_w.toggleFooter(!0);var footer=r.Templates.Processor.process(r.Templates.Storage.get("salon","footer"),{salon_adress_string:!1,salon_phone_string:!1,salon_widget_reservi_ru:r.Lang.getMessage("salon_reservi_ru"),salon_widget_work_on:r.Lang.getMessage("salon_work_on_"+this.redaction||"")}),_footer=_w.getFooter();_footer.addClass("reservi_salon_selector");_footer.find(".reservi_footer_on_start_proccess").each(function()
{var t=$(this);t.html(footer);t.show()})}};selector.prototype.onStepChangeFooter=function(prev)
{if(!(prev instanceof selector)&&!(prev instanceof s.CitySelector))
{this.revealIframeMap()}};selector.prototype.onHideStepChangeFooter=function(next)
{if(!(next instanceof selector)&&!(next instanceof s.CitySelector))
{this.removeIframeMap();this.getWidget().getFooter().removeClass("reservi_salon_selector");this.unbindScrolling()}};selector.prototype.sendMapCommand=function(command,data)
{this.__map_commands.push({command:command,data:data||""});this.processMapCommands()};selector.prototype.showCities=function()
{this.sendMapCommand('cities')};selector.prototype.processMapCommands=function()
{if(this.__map_window)
{while(this.__map_commands.length)
{var command=this.__map_commands.shift(),data="";if(command.data)
{try
{data=JSON.stringify(command.data)}
catch(e)
{}}
this.__map_window.postMessage(command.command+'|'+data,w.location.protocol+this.getWidget().getDomain())}
r.Utils.Array.iterate(this.__map_commands,function(_v,k)
{if(_v===a)
{self.__map_commands.splice(k,1);return!1}})}};selector.prototype.replaceFrame=function(from,to,timeout,callback)
{var self=this,_w=this.getWidget(),frame=this.getMapWrapper().find(from+".reservi_salons_map_frame"),listener=_w.getMessageListener();if(frame.length>0)
{listener.off("scrollpane_scroll");listener.off("call_city");listener.off("call_salon");listener.off("map_loaded");if(to!=="iframe")
{this.__map_window=null;this.__map_commands=[]}
else{var scroller=_w.getScroll();if(scroller instanceof r.UI.Scroller.Pane)
{listener.on("scrollpane_scroll",function(deltaY)
{scroller.scrollDelta(deltaY,0)})}
if(_w.getStep(s.CitySelector))
{listener.on("call_city",function(city)
{self.selectCity(city)})}
listener.on("call_salon",function(salon)
{if(salon)
{self.getBodyElement().find(".widget_salon_selector_salon[data-salon='"+salon+"']").trigger("click");listener.off("call_salon")}});listener.on("map_loaded",function(data,event)
{listener.off('map_loaded');self.__map_window=self.getMapWrapper().find("iframe")[0].contentWindow;self.processMapCommands()},!0)}
this.getWidget().getTimeouter().add(function()
{frame.each(function()
{var t=$(this),html='',attributes=[],e=document.createElement(to);$.each(this.attributes,function()
{var __from=(from==="div")?"data-src":"src",__to=(from==="div")?"src":"data-src";e.setAttribute((this.name===__from)?__to:this.name,this.value)});var el=$(e);if(from==="div")
{el.attr("data-message",t.text())}
else{el.text(el.attr("data-message"))}
t.replaceWith(el);self.getWidget().getScroll().update();if(typeof(callback)==="function")
{callback()}})},timeout)}};selector.prototype.revealIframeMap=function()
{var self=this;this.replaceFrame("div","iframe",2500,function()
{if(!self.isCurrent()&&!(self.getWidget().getCurrentStep()instanceof s.CitySelector))
{self.removeIframeMap()}})};selector.prototype.removeIframeMap=function()
{this.replaceFrame("iframe","div",0)};selector.prototype.onShow=function(prev)
{this.onStepChangeFooter(prev)};selector.prototype.onHide=function(next)
{this.__superOnHideSelector(next);this.onHideStepChangeFooter(next)};selector.prototype.getPrevStep=function()
{return this.isCalledByCitySelector()?s.CitySelector:!1};selector.prototype.getBodyData=function(data,td)
{var listData={},self=this,salonsXMLS=[];if(data)
{var salons=[];r.Utils.Object.iterate(data,function(cur)
{if(cur.redaction&&!self.redaction)
{self.redaction=cur.redaction}
salonsXMLS.push(cur.XML_ID);salons.push({salon_id:cur.XML_ID,salon_name:cur.NAME||"",salon_redaction:cur.redaction||"",salon_redaction_url:cur.redaction_url||"",salon_adress:cur.adress||"",salon_image:cur.image,salon_phone:cur.phone||""})});data.items=new r.Templates.ListTemplate(td.salon,salons)}
this.salonsXML=salonsXMLS;return data};selector.prototype.getHeadData=function(data,td)
{return{}};selector.prototype.onDestroy=function()
{this.getWidget().getFooter().removeClass("reservi_salon_selector");this.unbindScrolling()};selector.prototype.unbindScrolling=function()
{this.getWidget().getMessageListener().off("scrollpane_scroll")};s.SalonSelector=selector})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{});(function($,w,r,s,v)
{if(typeof(v.Dates)!=="undefined")
{return}
var dates=function(widget,id,data)
{s.LoadableStep.apply(this,arguments);this.__calendar=!1};dates.prototype=Object.create(s.LoadableStep.prototype);dates.prototype.constructor=dates;dates.prototype.__superDatesOnBeforeShow=dates.prototype.onBeforeShow;dates.prototype.__superDatesOnShowContentUpdated=dates.prototype.onShowContentUpdated;dates.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("dates")};dates.prototype.getHeadData=function()
{return{}};dates.prototype.getBodyData=function()
{return{}};dates.prototype.getPrevStep=function()
{return s.Main};dates.prototype.updateContent=function(data,content)
{this.buildCalendar(content);this.updateDates(data)};dates.prototype.buildCalendar=function(content)
{if(this.__calendar===!1)
{var c=(content)?content:this.getContent(),curDate=new Date(),html="",self=this,_w=this.getWidget();this.__calendar=!0;var months=[];for(var k=-1;k<7;k++)
{var date=new Date(curDate.getFullYear(),curDate.getMonth()+k),items=this.getMonthDates(date),weeks=r.Utils.Array.chunk(items,7),monthNum=date.getMonth(),aWeeks=[];oMonth={date:date,name:this.getMonthName(date.getMonth())+" "+date.getFullYear(),items:items};(function(monthNum){var tick=0;r.Utils.Array.iterate(weeks,function(_cur)
{if(tick!==0&&_cur.length&&_cur[0]&&_cur[0].d.getMonth()!==monthNum)
{return}
aWeeks.push({days:new r.Templates.ListTemplate(self.getTemplate("calendar-day"),_cur)});tick++})})(monthNum);oMonth.weeks=new r.Templates.ListTemplate(this.getTemplate("calendar-weeks"),aWeeks);months.push(oMonth)}
_w.getStep(_w.steps.times).buildCalendar(months);html+=r.Templates.Processor.process(this.getTemplate("months"),{months:new r.Templates.ListTemplate(this.getTemplate("month"),months)});html+=r.Templates.Processor.process(this.getTemplate("calendar"),{months:new r.Templates.ListTemplate(this.getTemplate("calendar-month"),months)});content.html(html);this.__calendarNav=content.find('.reservi_widget-regular');this.__calendarTables=content.find('.reservi_wiget_slmain');this.__calendarNav.slickReservi({dots:!1,infinite:!1,slidesToShow:3,slidesToScroll:1,asNavFor:this.__calendarTables,focusOnSelect:!0,centerMode:!0,prevArrow:'<div class="slick-prev"></div>',nextArrow:'<div class="slick-next"></div>'});this.__calendarTables.slickReservi({slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!1,infinite:!1,asNavFor:this.__calendarNav});this.__calendarNav.slickReservi("slickGoTo",1,!0)}};dates.prototype.getMonthName=function(m)
{return r.Lang.getMessage("dates_month_"+(m||0))};dates.prototype.getMonthDates=function(monthDate)
{var res=[],m=new Date(monthDate.getFullYear(),monthDate.getMonth()),start=r.Utils.DateTime.getDayOfWeekEurope(m,0),end=r.Utils.DateTime.getDayOfWeekEurope(new Date(m.getFullYear(),m.getMonth()+1,0),6),dayLen=1000*60*60*24,difDays=Math.ceil((end.getTime()-start.getTime())/dayLen),timeWalker=start,date;for(var i=0;i<=difDays;i++)
{date=timeWalker.getDate();var n=(date>9)?date:"0"+date,mNum=timeWalker.getMonth()+1,_day=timeWalker.getDay();var item={"day_dmy":n+" "+(mNum>9?mNum:"0"+mNum)+" "+timeWalker.getFullYear(),"day_num":n,"w":_day,"week-name":r.Lang.getMessage("dates_day_"+_day),d:new Date(timeWalker.getTime())};res.push(item);timeWalker.setDate(timeWalker.getDate()+1)}
return res};dates.prototype.updateDates=function(data)
{var content=this.getContent(),self=this,$class="reservi_widget_date_active",dates=content.find(".reservi_widget_day_selector");dates.removeClass($class);this.__dates={};if(data&&data.length>0)
{if(!this.__binded)
{dates.bind("click.dates",function()
{var t=$(this);if(t.is("."+$class))
{self.selectDate(t.attr("data-date"))}});this.__binded=!0}
r.Utils.Array.iterate(data,function(_cur,k)
{if(data[k].dmy)
{self.__dates[_cur.dmy]=_cur;dates.filter("[data-date='"+_cur.dmy+"']").addClass($class)}})}
this.getTimeStep().setActiveDays(data)};dates.prototype.selectDate=function(date)
{if(date&&this.__dates[date])
{var d=this.__dates[date],_w=this.getWidget(),_t=this.getTimeStep();_t.selectDay(date);_w.selectStep(_t)}};dates.prototype.getReqType=function()
{return "dates"};dates.prototype.getReqParams=function()
{return this.getWidget().getOrderData()};dates.prototype.onBeforeShow=function(prev)
{this.__superDatesOnBeforeShow(prev);this.__updateSliders()};dates.prototype.__updateSliders=function(t)
{if(typeof(t)==="undefined")
{t=30}
if(this.__calendarNav&&this.__calendarTables)
{var _ar=[this.__calendarNav,this.__calendarTables];this.getWidget().getTimeouter().add(function()
{r.Utils.Array.iterate(_ar,function(_cur)
{_cur.trigger("slick-shake")})},t)}};dates.prototype.getTimeStep=function()
{if(!this.__timesStep)
{var _w=this.getWidget();this.__timesStep=_w.getStep(_w.steps.times)}
return this.__timesStep};dates.prototype.onShowContentUpdated=function()
{this.__superDatesOnShowContentUpdated();this.__updateSliders()};v.Dates=dates})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Visit=window.ReserviCloud.Steps.Visit||{});(function($,w,r,v)
{if(typeof(v.Factory)!=="undefined")
{return}
var _m=[v.Manager.Query,v.Manager.Cookie];v.Factory={getManager:function(w)
{var res=null;r.Utils.Array.iterate(_m,function(_cur)
{if(_cur.isActive(w))
{res=new _cur(w);return!1}});return res}}})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.VisitParams=window.ReserviCloud.VisitParams||{});(function($,w,r,c)
{if(typeof(c.MessageListener)!=="undefined")
{return}
var __eventsNames="message.reservi_message_listener onmessage.reservi_message_listener",listener=function(widget)
{c.Component.apply(this,arguments);this.refresh();this.__registered=!1};listener.prototype=Object.create(c.Component.prototype);listener.prototype.constructor=listener;listener.prototype.__superListenerDestroy=listener.prototype.destroy;listener.prototype.on=function(command,callback,parse)
{this.__register();this.__collection.push({"command":command,"callback":callback,"parse":parse})};listener.prototype.off=function(command)
{var self=this;r.Utils.Array.iterate(this.__collection,function(_v,k)
{if(_v.command===command)
{self.__collection.splice(k,1)}});if(this.__collection.length<=0)
{this.__unregister()}};listener.prototype.__register=function()
{if(this.__registered===!1)
{var self=this,_w=this.getWidget();_w.getWindow().on(__eventsNames,function(e)
{if(e.originalEvent.origin&&e.originalEvent.origin.indexOf(_w.getDomain())!==-1)
{var result=e.originalEvent.data||"",parts=result.split("|");if(parts.length>1)
{if(parts[0])
{r.Utils.Array.iterate(self.__collection||[],function(a)
{if(a.command===parts[0])
{var data=parts[1];if(data)
{try
{data=JSON.parse(data)}
catch(e)
{}}
a.callback(data,e)}})}}}});this.__registered=!0}};listener.prototype.__unregister=function()
{if(this.__registered===!0)
{this.refresh();this.getWidget().getWindow().off(__eventsNames);this.__registered=!1}};listener.prototype.refresh=function()
{this.__collection=[]};listener.prototype.destroy=function()
{this.__unregister();this.__superListenerDestroy()};c.MessageListener=listener})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Components=window.ReserviCloud.Components||{});(function($,w,r,c)
{if(typeof(c.LocalStorage)!=="undefined")
{return}
var storage=function(widget)
{c.Component.apply(this,arguments);this.__storage={}};storage.prototype=Object.create(c.Component.prototype);storage.prototype.constructor=storage;storage.prototype.__superTimeouterDestroy=storage.prototype.destroy;storage.prototype.get=function(id)
{return this.__storage[id]};storage.prototype.set=function(id,val)
{this.__storage[id]=val};storage.prototype.remove=function(id)
{delete this.__storage[id]};storage.prototype.addKey=function(id,key,val)
{if(typeof(this.get(id))!=="object")
{this.set(id,{})}
this.get(id)[key]=val};storage.prototype.deleteKey=function(id,key)
{delete this.get(id)[key]};storage.prototype.push=function(id,val)
{var _array=this.get(id);if(typeof(_array)==="undefined")
{_array=[]}
_array.push(val);this.set(id,_array)};storage.prototype.destroy=function()
{delete this.__storage};c.LocalStorage=storage})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Components=window.ReserviCloud.Components||{});(function($,w,r,c)
{if(typeof(c.Requester)!=="undefined")
{return}
var requester=function(widget)
{c.Component.apply(this,arguments);this.__requests=[];this.requestTimes={}};requester.prototype=Object.create(c.Component.prototype);requester.prototype.constructor=requester;requester.prototype.__superRequesterDestroy=requester.prototype.destroy;requester.prototype.sendReq=function(req_t,_p,callback)
{params=$.extend({},_p);if(req_t)
{params.req_t=(r.Utils.Array.is(req_t))?req_t.join("-"):req_t}
this.send("request",params,callback)};requester.prototype.send=function(type,_p,callback)
{if(!type)
{return!1}
var _w=this.getWidget();params=$.extend({},_p);params.state=type;var salon=_w.getSalon();if(salon)
{params.salon=salon}
var self=this,checkRequest=!1;if(type==="request"&&params.req_t&&params.req_t.length>0)
{var currentTime=Date.now(),arTypes=params.req_t.split("-"),proccessParams=[];if(arTypes.length>0)
{checkRequest=!0;r.Utils.Array.iterate(arTypes,function(val,typeKey)
{proccessParams.push(arTypes[typeKey]);self.requestTimes[arTypes[typeKey]]=currentTime})}}
r.Widget.sendRequest(type,params,function(response)
{_w.hideLoader();if(typeof(response)==="object")
{if(checkRequest&&proccessParams.length>0)
{r.Utils.Array.iterate(proccessParams,function(_v,PPKey)
{if(self.requestTimes[proccessParams[PPKey]]!==currentTime)
{response[proccessParams[PPKey]]=undefined}
else{self.requestTimes[proccessParams[PPKey]]=0}})}
if(typeof(callback)==="function")
{callback(response)}}},function(__request)
{self.__remove(__request)},function(__request)
{self.__add(__request)});_w.showLoader()};requester.prototype.__add=function(a)
{this.__requests.push(a)};requester.prototype.__remove=function(a)
{var self=this;r.Utils.Array.iterate(this.__requests,function(_v,k)
{if(_v===a)
{self.__requests.splice(k,1);return!1}})};requester.prototype.__abort=function()
{var self=this;r.Utils.Array.iterate(this.__requests,function(_v,k)
{_v.abort();self.__requests.splice(k,1)})};requester.prototype.destroy=function()
{this.__abort();this.__superRequesterDestroy()};c.Requester=requester})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Components=window.ReserviCloud.Components||{});(function($,w,r,s,o)
{if(typeof(o.Success)!=="undefined")
{return}
success=function(rWidget,rId,data)
{o.AOrder.apply(this,arguments)};success.prototype=Object.create(o.AOrder.prototype);success.prototype.constructor=success;success.prototype.__superSuccessOnBeforeShow=success.prototype.onBeforeShow;success.prototype.getInfoElement=function()
{if(!this.__successInfo)
{this.__successInfo=this.getBodyElement().find('[data-success-info]')}
return this.__successInfo};success.prototype.onBeforeShow=function(prev)
{this.__superSuccessOnBeforeShow(prev);var _d=this.getParams(),_o=this.getOrder(),_w=this.getWidget(),messages=_d.messages;if(_d&&!_d.price)
{_d.price=_o.getOrderSum()}
this.getInfoElement().html(r.Templates.Processor.process(this.getTemplate("compile"),{message:messages.first||"",message2:messages.second||"",price:(_d.price)?_d.price+_w.getSalonValute():!1,show_close_btn:!_w.isApplication()}));this.getBodyElement().find("[data-success-close]").unbind("click").bind("click",function(){_w.closeWidget(!0)})};success.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("success")};success.prototype.getBodyData=function(data,td)
{return{}};success.prototype.getHeadData=function(data,td)
{return{}};success.prototype.getPrevStep=function()
{};o.Success=success})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Steps.Order=window.ReserviCloud.Steps.Order||{});(function($,w,r,c)
{if(typeof(c.Timeouter)!=="undefined")
{return}
var timeouter=function(widget)
{c.Component.apply(this,arguments);this.__collection=[]};timeouter.prototype=Object.create(c.Component.prototype);timeouter.prototype.constructor=timeouter;timeouter.prototype.__superTimeouterDestroy=timeouter.prototype.destroy;timeouter.prototype.add=function(func,time)
{var self=this,_t=setTimeout(function()
{self.remove(_t);func()},time);this.__collection.push(_t);return _t};timeouter.prototype.remove=function(t)
{var self=this;r.Utils.Array.iterate(this.__collection,function(_v,k)
{if(_v===t)
{self.__collection.splice(k,1);return!1}})};timeouter.prototype.__abort=function()
{var self=this;r.Utils.Array.iterate(this.__collection,function(_v,k)
{clearTimeout(_v);self.__collection.splice(k,1)})};timeouter.prototype.destroy=function()
{this.__abort();this.__superTimeouterDestroy()};c.Timeouter=timeouter})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Components=window.ReserviCloud.Components||{});(function($,w,r,s)
{if(typeof(s.CitySelector)!=="undefined")
{return}
var city=function(rWidget,rId,data)
{s.Abstract.apply(this,arguments)};city.prototype=Object.create(s.Abstract.prototype);city.prototype.constructor=city;city.prototype.onNullTemplate=function()
{return r.Templates.Storage.get("city")};city.prototype.getBodyData=function(data,td)
{if(data)
{var cities=[];r.Utils.Array.iterate(data.cities,function(cityName)
{cities.push({name:cityName})});data.items=new r.Templates.ListTemplate(td.city,cities.sort(function(a,b)
{return a.name.localeCompare(b.name)}))}
return data};city.prototype.getHeadData=function(data,td)
{return data};city.prototype.onStart=function()
{var self=this;this.getBodyElement().find('[data-city]').unbind("click").bind("click",function()
{var t=$(this),city=t.attr("data-city");self.getSalonSelectorStep().selectCity(city)})};city.prototype.onBeforeShow=function(prev)
{var selector=this.getSalonSelectorStep();selector.beforeStepChangeFooter(prev);selector.selectMapSalons(null);this.getWidget().setTitle(r.Lang.getMessage("city_title"))};city.prototype.onShow=function(prev)
{var step=this.getSalonSelectorStep();step.onStepChangeFooter(prev);step.showCities()};city.prototype.onBeforeHide=function(next)
{};city.prototype.onHide=function(next)
{this.getSalonSelectorStep().onHideStepChangeFooter(next)};city.prototype.getPrevStep=function()
{return!1};city.prototype.getSalonSelectorStep=function()
{if(!this.__selectorStep)
{this.__selectorStep=this.getWidget().getStep(s.SalonSelector)}
return this.__selectorStep};city.prototype.getPostContentElement=function()
{return this.getSalonSelectorStep().getPostContentElement()};s.CitySelector=city})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{});(function($,w,r,s,t)
{if(r.Widget)
{return}
var instance,oW=$(w),oB=$("body"),relay=location.protocol+"//reservi.ru/4.0/",force_widget_on_load,force_parameter="widget",isApplication=oB.is(".reservi_application")||oB.is(".disable_close_btn"),organInited=!1,postContainerInrementer=0,def_init=!1;function unsetInstance()
{if(instance)
{instance.destroy()}
instance=null}
function createInstance()
{if(instance)
{unsetInstance()}
instance=new Widget();oB.addClass("always_scroll");return instance}
r.Widget={version:r.version,getVersion:function()
{return this.version},getSalonElementParams:function(t)
{var preinited=t.attr("data-salon-preinited")==="Y";return{salon:t.attr("data-salon"),params:(preinited)?{salon_name:t.attr("data-salon-name"),salon_image:t.attr("data-salon-image"),salon_adress:t.attr("data-salon-adress"),salon_phone:t.attr("data-salon-phone"),redaction:t.attr("data-salon-redaction"),redaction_url:t.attr("data-salon-redaction_url"),salons_selector:t.attr("data-from-salons")==="Y",salon_city:t.attr("data-salon-city"),salonPreInited:preinited}:!1}},getElementsCallParams:function(t)
{var res={};if(t)
{var self=this;t.each(function()
{var s=$(this),salon=s.attr("data-salon");if(salon)
{res[salon]={NAME:s.attr("data-salon-name"),name:s.attr("data-salon-name"),XML_ID:salon,adress:s.attr("data-salon-adress"),image:s.attr("data-salon-image"),phone:s.attr("data-salon-phone"),redaction:s.attr("data-salon-redaction"),redaction_url:s.attr("data-redaction_url"),city:s.attr('data-salon-city')}}})}
return res},salonByElement:function(t)
{var data=this.getSalonElementParams(t);this.salon(data.salon,data.params)},salon:function(salon,params)
{if(!salon)
{r.Core.warning("Wrong salon");return}
createInstance().initSalon(salon,params)},salonSelector:function(salons)
{if(!salons)
{r.Core.warning("Wrong salons");return}
createInstance().salonSelector(salons)},closeWidget:function(anyway)
{if(instance)
{if(!oB.is(".disable_close_btn")||anyway)
{if(!isApplication||anyway)
{oB.removeClass("always_scroll");instance.getElement().fadeOut("slow",function()
{$(this).html("")})}
else{instance.triggerBtn()}}
instance.sendEvent("close");unsetInstance()}},startButton:function(salonId)
{var Elements=(salonId)?$('.widget_reservi_loader_4[data-salon="'+salonId+'"],.widget_reservi_loader[data-salon="'+salonId+'"]').not(".reservi-not-start-button").filter("[data-salon-preinited='Y']"):!1,salons=[];if(Elements===!1||!Elements.length)
{Elements=$(".widget_reservi_loader_4,.widget_reservi_loader").not(".reservi-not-start-button").filter("[data-salon-preinited='Y']")}
Elements.each(function()
{var t=$(this),salon=t.attr("data-salon");if(salon&&salons.indexOf(salon)===-1)
{salons.push(salon)}});if(salons.length>1)
{this.salonSelector(this.getElementsCallParams(Elements))}
else{this.salonByElement(Elements)}},isForceWidget:function()
{if(typeof(force_widget_on_load)==="undefined")
{force_widget_on_load=(oB.is(".reservi_force_btn"))||w.reservi_widget===!0||String(r.Utils.Uri.getPageParameter("widget")).toLowerCase()==="y"}
return force_widget_on_load},initSalons:function(t)
{var self=this;t.unbind("click.widgetInit").bind("click.widgetInit",function()
{self.salonByElement($(this))})},initDefault:function()
{if(def_init)
{return}
def_init=!0;var targets=oB.find(".widget_reservi_loader_4,.widget_reservi_loader"),SalonsToInit=[],self=this;this.initSalons(targets);targets.each(function()
{var salonId=$(this).attr("data-salon");if(typeof(salonId)!=="undefined"&&salonId.length>0)
{SalonsToInit.push(salonId)}});if(SalonsToInit.length>0)
{this.preinitSalons(SalonsToInit,function(f,o)
{if(!organInited&&o)
{var Elements=$(".widget_reservi_loader_4,.widget_reservi_loader").not(".reservi-not-start-button");if(o.SHOW_BUTTON&&o.BUTTON_POSITION&&Elements.length>0)
{var $buttonTpl=r.Templates.Processor.process(r.Templates.Storage.get("skeleton","button"),{"btn_class":o.BUTTON_POSITION});oB.append($buttonTpl)}
$("#reservi_button_link_start, .reservi_button_emulation").bind("click",function(e)
{self.startButton()});oB.on('click','a[href="#reservi_button_emulation"]',function()
{self.startButton()})}
if(self.isForceWidget())
{self.startButton(r.Utils.Uri.getPageParameter("salon")||!1)}
organInited=!0},r.organization)}},preinitSalons:function(salons,callback,org)
{var SalonsToInit=salons||[],self=this;if(SalonsToInit.length===0)
{oB.find(".widget_reservi_loader_4, .widget_reservi_loader").not("[data-salon-preinited='Y']").each(function()
{var t=$(this),salonID=t.attr("data-salon");if(salonID&&SalonsToInit.indexOf(salonID))
{SalonsToInit.push(salonID)}})}
if(SalonsToInit.length>0)
{this.sendRequest("fastinit",{salons:SalonsToInit,client:org,source_info:encodeURIComponent(this.getSiteSourceCompain())},function(jsonData)
{if(jsonData)
{if(jsonData.fastinit)
{r.Utils.Object.iterate(jsonData.fastinit,function(v,Salon)
{var Targets=$(".widget_reservi_loader_4[data-salon='"+Salon+"'],.widget_reservi_loader[data-salon='"+Salon+"']").not("[data-salon-preinited='Y']");if(Targets.length>0)
{self.buildSalonAttributes(Targets,v)}})}}
if(typeof(callback)==="function")
{callback(jsonData.fastinit,jsonData.organ)}})}},buildSalonAttributes:function(t,params)
{var a=[],fieldsArray=["name","image","adress","phone","redaction","redaction_url",'city'];r.Utils.Array.iterate(fieldsArray,function(v,k)
{var val=(params[v])?params[v]:"";if(params[v])
{if(v==="image")
{var preImage=new Image();preImage.src=params[v]}}
t.attr("data-salon-"+v,val)});t.attr("data-salon-preinited","Y")},getSiteSourceCompain:function()
{var $params=r.Utils.Uri.buildLinkParams(r.Utils.Uri.getPageParamsByKeyPreg("(utm_.*)"));return($params)?$params:document.referrer||w.location.hostname},sendRequest:function(type,params,callback,complete,before)
{if(!type)
{r.Core.error("There is no type")}
if(!params)
{params={}}
params.state=type;params.ver=this.version;return r.Ajax.send(relay,params,function(data)
{if(data)
{var _c={callback:function()
{if(data.data&&typeof(callback)==="function")
{callback(data.data)}}},bWait=!1;if(data.system)
{r.AjaxProccessor.proccess(data.system);if(data.system.assets&&data.system.assets.length!==0)
{bWait=!0;r.Assets.load(data.system.assets,_c.callback)}}
if(!bWait)
{_c.callback()}}},"json",complete,before)}};var Widget=function()
{this.prevInited=!1;this.rootElement=null;this.footer=null;this.prepadd=null;this.footer_state=!1;this.domain="//reservi.ru";this.reserviUri=location.protocol+"//reservi.ru/4.0/";this.steps={salons:"reservi_widget_salons_selecotor",city:"reservi_widget_city_selector",main:"reservi_widget_main_step",masters:"reserv-widget_step-staff",master:"reserv-widget_staff_detail",masterInfo:"reserv-widget_staff_information",services:"reserv-widget_step-service",dates:"reserv-widget_step-date",times:"reserv-widget_step-time",order:"reserv-widget_step-order-make",finish:"reserv-widget_step-finish"};var self=this;this.__visitSteps=[{func:s.Visit.Masters,id:self.steps.masters},{func:s.Visit.Services,id:self.steps.services},{func:s.Visit.Master,id:self.steps.master},{func:s.Visit.MasterInfo,id:self.steps.masterInfo},{func:s.Visit.Dates,id:self.steps.dates},{func:s.Visit.Times,id:self.steps.times}];this.__orderSteps=[{func:s.Order.Order,id:self.steps.order},{func:s.Order.Success,id:self.steps.finish}];this.__components={"message_listener":new r.Components.MessageListener(this),"timeouter":new r.Components.Timeouter(this),"requester":new r.Components.Requester(this),'local_storage':new r.Components.LocalStorage(this)};this.orderParams={services:"services",staff:"staff",date:"date",time:"time"};this.stepsCache={};this.__banner=null;this.currentStep=!1;this.requestLoader=!1;this.salon=!1;this.isMobDevice=null;this.isNeedUpdate={};this.fadeSpeed=300;this.stepsChangeSequence=[];this.stepsWrapper=this.stepsHeadersWrapper=this.postContentElement=null;this.systemStepsRegistred=!1;this.refreshData();this.init()};Widget.prototype.refreshData=function()
{this.orderData={};this.__order=!1;this.__recordData={};this.salonData={};this.unregisterVisitSteps();this.enableCookie()};Widget.prototype.getComponent=function(component)
{return this.__components[component]};Widget.prototype.getMessageListener=function()
{return this.getComponent("message_listener")};Widget.prototype.getTimeouter=function()
{return this.getComponent("timeouter")};Widget.prototype.getRequester=function()
{return this.getComponent("requester")};Widget.prototype.getLocalStorage=function()
{return this.getComponent("local_storage")};Widget.prototype.init=function()
{this.rootElement=$("#reservi_widget_main #reservi_widget_content");this.reserviOrderButton=this.rootElement.find("#widget_make_order");this.rootElement.html(r.Templates.Processor.process(t.Storage.get("instance","body"),{close:!isApplication}));this.scroll=new r.UI.Scroller[(this.isMob())?"Browser":"Pane"](this,this.getElement().find(".reservi_widget-innerscroll"),this.getFadeSpeed());this.rootElement.fadeIn(this.getFadeSpeed());this.prev=this.rootElement.find(".reservi_widget-back a");this.requestLoader=this.rootElement.find(".reservi_widget_loader_wrapper");this.stepsWrapper=this.rootElement.find("#reservi_widget_steps_wrapper");this.stepsHeadersWrapper=this.rootElement.find("#reservi_steps_headers");this.postContentElement=this.rootElement.find("#reservi_post_content");this.bindWidgetEvents();this.getScroll().update()};Widget.prototype.salonSelector=function(salons)
{var startStep=this.steps.salons;if(!this.isStepExist(this.steps.salons))
{var cities=[],bMultiCities=!1;if(salons)
{r.Utils.Object.iterate(salons,function(salon)
{if(salon.city)
{if(cities.indexOf(salon.city)===-1)
{cities.push(salon.city)}
else{bMultiCities=!0}}});if(cities.length>1&&bMultiCities)
{startStep=this.createStep(s.CitySelector,this.steps.city,{data:{cities:cities}})}}
this.createStep(s.SalonSelector,this.steps.salons,{data:salons,restore:(salons===!1)})}
else{var citySelector=this.getStep(s.CitySelector);if(citySelector)
{startStep=citySelector}}
this.selectStep(startStep)};Widget.prototype.disableCookie=function()
{this.__isCookie=!1};Widget.prototype.enableCookie=function()
{this.__isCookie=!0};Widget.prototype.isCookieEnabled=function()
{return this.__isCookie===!0};Widget.prototype.__registerStepsHay=function(__hay)
{var self=this;r.Utils.Array.iterate(__hay,function(a)
{self.createStep(a.func,a.id)})};Widget.prototype.__unregisterStepsHay=function(__hay)
{var steps=[];r.Utils.Array.iterate(__hay,function(a)
{steps.push(a.id)});this.deleteSteps(steps)};Widget.prototype.registerVisitParamsManager=function()
{this.__visit_params_manager=r.VisitParams.Factory.getManager(this);return this.__visit_params_manager};Widget.prototype.unregisterVisitParamsManager=function()
{if(this.__visit_params_manager)
{delete this.__visit_params_manager}};Widget.prototype.registerVisitSteps=function()
{if(!this.__visitStepsRegistred)
{this.__registerStepsHay(this.__visitSteps);this.__visitStepsRegistred=!0}};Widget.prototype.unregisterVisitSteps=function()
{this.__visitStepsRegistred=!1;this.__unregisterStepsHay(this.__visitSteps)};Widget.prototype.registerOrderSteps=function()
{if(!this.__orderStepsRegistred)
{this.__registerStepsHay(this.__orderSteps);this.__orderStepsRegistred=!0}};Widget.prototype.createOrder=function()
{if(!this.__order)
{this.__order=new r.Order(this)}};Widget.prototype.prepareOrder=function()
{this.createOrder();this.registerOrderSteps()};Widget.prototype.getOrder=function()
{return this.__order};Widget.prototype.initSalon=function(salon,initial)
{var self=this,prevInstance=this.getStep(s.Main),params=initial||{};this.refreshData();this.setSalon(salon);if(!salon)
{r.Core.error("Не указан салон");return!1}
if(prevInstance)
{this.removeStep(prevInstance)}
var _manager=this.registerVisitParamsManager();var _cb={main:function()
{self.registerVisitSteps()},func:function(callback)
{_cb.main();self.getTimeouter().add(function()
{if(_manager&&_manager instanceof r.VisitParams.Manager.Abstract)
{_manager.run(callback);return}
callback()},self.getFadeSpeed())}};if(!params.salonPreInited)
{r.Widget.preinitSalons([salon],function(info)
{var _salonData=(info[salon])?info[salon]:{};self.selectStep(self.createStep(s.Main,self.steps.main,{data:{redaction:_salonData.redaction||"",redaction_url:_salonData.redaction_url||"",salon:salon||"",salonPreInited:!0,salon_adress:_salonData.adress||"",salon_image:_salonData.image||"",salon_name:_salonData.name||"",salon_phone:_salonData.phone||"",salons_selector:params.salons_selector,salon_city:_salonData.city,callback:_cb.func}}))})}
else{params.callback=_cb.func;this.selectStep(this.createStep(s.Main,this.steps.main,{data:params}))}};Widget.prototype.setSalon=function(salon)
{this.salon=salon};Widget.prototype.getSalon=function()
{return this.salon};Widget.prototype.getOrganization=function()
{return r.organization};Widget.prototype.isService=function(service)
{var res=this.getOrderData(this.orderParams.services)||[];return res.indexOf(service)!==-1};Widget.prototype.addService=function(service)
{this.setOrderData(this.orderParams.services,service,!0)};Widget.prototype.getServices=function()
{return this.getOrderData(this.orderParams.services)||[]};Widget.prototype.removeService=function(service)
{var data=this.getServices();if(typeof(data)!=="undefined")
{var i=r.Utils.Array.in_array(service,data);if(i!==!1)
{this.removeServiceIndex(i)}}};Widget.prototype.removeServiceIndex=function(i)
{this.setOrderData(this.orderParams.services,i,!0,!0)};Widget.prototype.setStaff=function(staff)
{this.setOrderData(this.orderParams.staff,staff)};Widget.prototype.unsetStaff=function()
{this.setStaff(!1)};Widget.prototype.getStaff=function()
{return this.getOrderData(this.orderParams.staff)||!1};Widget.prototype.setDate=function(date)
{this.setOrderData(this.orderParams.date,date)};Widget.prototype.unsetDate=function()
{this.setDate(!1)};Widget.prototype.getDate=function()
{return this.getOrderData(this.orderParams.date)||!1};Widget.prototype.setTime=function(time)
{this.setOrderData(this.orderParams.time,time)};Widget.prototype.unsetTime=function()
{this.setTime(!1)};Widget.prototype.getTime=function()
{return this.getOrderData(this.orderParams.time)||!1};Widget.prototype.setOrderData=function(e,v,a,rm)
{if(a===!0)
{if(typeof(this.orderData[e])==="undefined")
{this.orderData[e]=[]}
if(rm===!0)
{if(this.orderData[e])
{this.orderData[e].splice(v,1)}}
else{if(!r.Utils.Array.in_array(v,this.orderData[e]))
{this.orderData[e].push(v)}}}
else{this.orderData[e]=v}
this.getStep(this.steps.main).proccessOrderBtn();if(this.isCookieEnabled())
{r.VisitParams.Manager.Cookie.saveCache(this)}};Widget.prototype.getWindow=function()
{return oW};Widget.prototype.getRedaction=function()
{return this.getStep(this.steps.main).getData("redaction")};Widget.prototype.getOrderData=function(a)
{return(a)?this.orderData[a]:this.orderData};Widget.prototype.getDomain=function()
{return this.domain};Widget.prototype.getUri=function()
{return this.reserviUri};Widget.prototype.getElement=function()
{return this.rootElement};Widget.prototype.getStepsElement=function()
{return this.stepsWrapper};Widget.prototype.getStepsHeadersElement=function()
{return this.stepsHeadersWrapper};Widget.prototype.getPostContentElement=function()
{return this.postContentElement};Widget.prototype.createPostContentContainer=function()
{var containerId="reservi_post_content_container_"+postContainerInrementer,postContent=this.getPostContentElement();postContent.append('<div id="'+containerId+'" data-post-content-conainer></div>');postContainerInrementer++;return postContent.find('#'+containerId)};Widget.prototype.getOrderButton=function()
{return this.reserviOrderButton};Widget.prototype.getFadeSpeed=function()
{return this.fadeSpeed};Widget.prototype.registerStep=function(step,id)
{if(this.stepsCache[id])
{r.Core.error("Step "+id+" is already registred")}
if(!(step instanceof s.Abstract))
{r.Core.error(step+" is not instance of Reservui.Steps.Abstract")}
this.stepsCache[id]=step;return step};Widget.prototype.createStep=function(type,id,args)
{if(type.__proto__!==s.Abstract.__proto__)
{r.Core.error("Wrong step type")}
var step=this.registerStep(new type(this,id,args),id);return step};Widget.prototype.removeStep=function(step)
{if(this.stepsCache[step.getStepId()])
{step.purge();delete this.stepsCache[step.getStepId()]}};Widget.prototype.getSteps=function()
{return this.stepsCache};Widget.prototype.getStep=function(step)
{var type=typeof(step),self=this;if(type==="string")
{return this.stepsCache[step]}
return r.Utils.Object.find(this.stepsCache,function(a)
{return(type==="function")?a instanceof step:a===step})};Widget.prototype.isStepExist=function(step)
{return!!this.getStep(step)};Widget.prototype.getCurrentStep=function()
{return this.currentStep};Widget.prototype.setCurrentStep=function(step)
{this.currentStep=this.getStep(step)};Widget.prototype.setTitle=function(title)
{this.getElement().find(".reservi_widget-titlehead .reservi_widget_title_name").text(title)};Widget.prototype.getFooterState=function()
{return this.footer_state};Widget.prototype.toggleFooter=function(state)
{this.footer_state=state;_a=(state)?"show":"hide";this.getFooter()[_a]()};Widget.prototype.registerBanner=function(banner)
{if(!(banner instanceof r.UI.Banner.Abstract))
{r.Core.unimplemented("Banner is not instance of UI.Banner.Abstract");return}
if(this.__banner)
{this.__banner.destroy(!0)}
this.__banner=banner};Widget.prototype.getBanner=function()
{return this.__banner};Widget.prototype.unregisterBanner=function()
{if(this.__banner)
{delete this.__banner}};Widget.prototype.selectStep=function(target,callback,params)
{if(!target)
{return}
self=this;var step=this.getStep(target),currentStep=this.getCurrentStep();if(!step)
{throw new Error("Wrong step")}
if(step===currentStep)
{return}
this.pushStepChange({prev:currentStep,next:step,callback:callback,"params":params||{}})};Widget.prototype.pushStepChange=function(params)
{this.stepsChangeSequence.push(params);this.__proccessStepSequence()};Widget.prototype.__proccessStepSequence=function()
{if(this.changingStep===!0)
{return}
var self=this;r.Utils.Array.iterate(this.stepsChangeSequence,function(current,k)
{var current=self.stepsChangeSequence[k],prev=current.prev,next=current.next,callback=current.callback,params=current.params;self.changingStep=!0;var stepCallback=function()
{if(typeof(callback)==="function")
{callback(prev,next)}
self.changingStep=!1;self.getScroll().update();self.__proccessStepSequence()};if(prev)
{prev.hide(next,function()
{next.show(prev,function()
{stepCallback()})})}
else{next.show(prev,stepCallback)}
self.stepsChangeSequence.shift();self.setCurrentStep(next);next.setParams(params);self.sendEvent("step",{from:(prev)?prev.getStepId():null,to:(next)?next.getStepId():null});self.processPrevStep();return!1})};Widget.prototype.processPrevStep=function()
{if(!this.prevInited)
{var self=this;this.prevInited=!0;this.prev.bind("click",function()
{var step=self.onPrevStep();if(step)
{self.selectStep(step)}})}
var step=this.onPrevStep();this.prev[step?"fadeIn":"fadeOut"](this.getFadeSpeed())};Widget.prototype.onPrevStep=function()
{if(this.getCurrentStep())
{return this.getCurrentStep().getPrevStep()}};Widget.prototype.setSalonData=function(params)
{this.salonData=params||{};this.proccessSalonData()};Widget.prototype.getSalonData=function(key)
{return(key)?this.salonData[key]:this.salonData};Widget.prototype.proccessSalonData=function()
{if(this.salonData.app)
{r.UI.Banner.App.init(this,this.salonData.app)}};Widget.prototype.getPhoneMaskString=function()
{var mask=this.getSalonData("phonemask");if(typeof(mask)!=="undefined")
{return(typeof(mask)!=="undefined")?r.Utils.String.replace(mask,"N","9"):"9999999999999"}};Widget.prototype.getPlaceHolderPhoneMaskString=function()
{return r.Utils.String.replace(this.getSalonData("phonemask"),"N","_")};Widget.prototype.getSalonValute=function()
{return this.getSalonData("valute")};Widget.prototype.isEmail=function()
{return!!this.getSalonData("email")};Widget.prototype.bindWidgetEvents=function()
{var self=this;this.bindCloseWidget();$(w).bind("resize",function()
{self.getScroll().update()})};Widget.prototype.bindCloseWidget=function()
{var self=this;this.getElement().find(".reservi_widget-close,.reservi_widget_close_widget").bind("click",function()
{self.closeWidget()});this.getElement().find("#close_widget_button").bind("click",function()
{self.closeWidget()})};Widget.prototype.closeWidget=function(anyway)
{if(!isApplication||anyway)
{this.destroy();r.Widget.closeWidget(anyway)}};Widget.prototype.destroy=function()
{this.deleteSteps();this.deleteComponents()};Widget.prototype.deleteSteps=function(a)
{if(this.stepsCache)
{var self=this,d=(r.Utils.Array.is(a))?a:[a],stepsDel=(typeof(a)==="undefined")?[]:d;r.Utils.Object.iterate(this.stepsCache,function(_d,s)
{if(typeof(a)==="undefined"||r.Utils.Array.in_array(function(b)
{return(typeof(b)==="string")?self.stepsCache[s].getStepId()===b:self.stepsCache[s]instanceof b},stepsDel)!==!1)
{self.stepsCache[s].purge();delete self.stepsCache[s]}})}};Widget.prototype.deleteComponents=function()
{if(this.__components)
{var self=this;r.Utils.Object.iterate(this.__components,function(_d,s)
{_d.destroy();delete self.__components[s]})}};Widget.prototype.getLoader=function()
{return this.requestLoader};Widget.prototype.hideLoader=function()
{if(this.getLoader())
{this.getLoader().fadeOut(700)}};Widget.prototype.showLoader=function()
{if(this.getLoader())
{this.getLoader().fadeIn(700)}};Widget.prototype.getScroll=function()
{return this.scroll};Widget.prototype.getHeader=function()
{if(!this.__header)
{this.__header=this.getElement().find('.reservi_widget-header')}
return this.__header};Widget.prototype.getPrePadd=function()
{if(!this.prepadd)
{this.prepadd=this.getElement().find(".reservi_widget_prepadd")}
return this.prepadd};Widget.prototype.getFooter=function()
{if(!this.footer)
{this.footer=this.getElement().find(".reservi_widget-footer")}
return this.footer};Widget.prototype.isMob=function()
{if(this.isMobDevice===null)
{this.isMobDevice=r.Utils.Client.isMobile()}
return this.isMobDevice};Widget.prototype.sendEvent=function(eventName,data)
{var salon;if(this.salon)
{salon=this.salon}
var details=(data)?data:{};document.dispatchEvent(new CustomEvent("reservi_"+eventName,{detail:{"salon":salon,"data":details}}))};Widget.prototype.loadAssets=function(assets,callback)
{this.getRequester().sendReq("assets",{assets:assets},typeof(callback)==="function"?function()
{callback()}:null)};Widget.prototype.isApplication=function()
{return isApplication};r.Widget.initDefault();$.fn.reserviCL=function()
{r.Widget.initSalons($(this))}})(jQuery,window,window.ReserviCloud=window.ReserviCloud||{},window.ReserviCloud.Steps=window.ReserviCloud.Steps||{},window.ReserviCloud.Templates=window.ReserviCloud.Templates||{})